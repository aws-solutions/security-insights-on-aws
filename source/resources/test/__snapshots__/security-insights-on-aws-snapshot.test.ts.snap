// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`Snapshot test for canary alarm 1`] = `
{
  "Conditions": {
    "CreateQuickSightQTopicsCondition": {
      "Fn::Equals": [
        {
          "Ref": "CreateQuickSightQTopics",
        },
        "Yes",
      ],
    },
    "CreateQuickSightUserGroupsCondition": {
      "Fn::Equals": [
        {
          "Ref": "CreateQuickSightUserGroups",
        },
        "Yes",
      ],
    },
    "CreateSolutionReleaseNotificationCondition": {
      "Fn::Equals": [
        {
          "Ref": "CreateNewSolutionReleaseNotification",
        },
        "Yes",
      ],
    },
  },
  "Description": "A solution for getting security insights from the data in the Security Lake",
  "Mappings": {
    "Solution": {
      "AthenaConfiguration": {
        "AthenaBucketPrefix": "athena_results/",
        "AthenaWorkgroupBucketName": "aws-athena-query-results-solutions-",
        "AthenaWorkgroupName": "SecurityInsights",
      },
      "GlueConfiguration": {
        "GlueDatabaseName": "security_insights_database",
        "GlueTableBucketPrefix": "/placeholderValues",
        "GlueTableName": "security_insights_table",
      },
      "InputConfiguration": {
        "Debug": "debug",
        "Error": "error",
        "Friday": "FRIDAY",
        "Info": "info",
        "Monday": "MONDAY",
        "Saturday": "SATURDAY",
        "Sunday": "SUNDAY",
        "Thursday": "THURSDAY",
        "Tuesday": "TUESDAY",
        "Warn": "warn",
        "Wednesday": "WEDNESDAY",
      },
      "LambdaFunctionConfiguration": {
        "CreateDataSetRefreshSchedulesFunctionName": "CreateDataSetRefreshSchedules",
        "CreateLakeFormationPermissionsFunctionName": "CreateLakeFormationPermissions",
        "CreateQuickSightDataSetFunctionName": "CreateQuickSightDataSets",
      },
      "QuickSightConfiguration": {
        "AdminUserGroupName": "AdminUserGroup",
        "QuickSightAnalysisId": "SecurityInsightsAnalysis",
        "QuickSightAnalysisName": "SecurityInsightsAnalysis",
        "QuickSightDashboardId": "SecurityInsightsDashboard",
        "QuickSightDashboardName": "SecurityInsightsDashboard",
        "QuickSightDataSetId": "DataSetId",
        "QuickSightDataSetName": "DataSet",
        "QuickSightDataSourceId": "AthenaDataSourceSecurityInsights",
        "QuickSightDataSourceName": "DataAthenaDataSourceSecurityInsightsSource",
        "QuickSightServiceLinkedRoleName": "aws-quicksight-service-role-v0",
        "ReadUserGroupName": "ReadUserGroup",
        "RefreshType": "FULL_REFRESH",
      },
      "SecurityLakeConfiguration": {
        "CloudtrailDataSourceName": "cloudtrail",
        "DefaultQueryWindowDuration": "7",
        "ResourceLinkDatabase": "aws_solutions_resource_link_database",
        "SecurityHubDataSourceName": "securityHub",
        "SecurityLakeAppFabricTableName": "ext_awsappfabric",
        "SecurityLakeCloudtrailTableName": "cloud_trail_mgmt_2_0",
        "SecurityLakeDatabasePrefix": "amazon_security_lake_glue_db",
        "SecurityLakeSecurityHubTableName": "sh_findings_2_0",
        "SecurityLakeTablePrefix": "amazon_security_lake_table",
        "SecurityLakeVpcTableName": "vpc_flow_2_0",
        "VpcDataSourceName": "vpcFlowLogs",
      },
      "SolutionConfiguration": {
        "AppRegistryApplicationName": "security-insights",
        "ApplicationType": "AWS-Solutions",
        "GitHubRepoUrl": "https://api.github.com/repos/aws-solutions/security-insights-on-aws/releases/latest",
        "ID": "SO0228",
        "MetricsURL": "https://metrics.awssolutionsbuilder.com/generic",
        "SendAnonymizedUsageData": "True",
        "SolutionName": "Security Insights on AWS",
        "UserAgentString": "",
        "Version": "v2.0.2",
      },
    },
  },
  "Metadata": {
    "AWS::CloudFormation::Interface": {
      "ParameterGroups": [
        {
          "Label": {
            "default": "Security Lake Settings",
          },
          "Parameters": [
            "SecurityLakeAccountId",
          ],
        },
        {
          "Label": {
            "default": "QuickSight Settings",
          },
          "Parameters": [
            "QuickSightUserNameArn",
            "CreateQuickSightUserGroups",
            "CreateQuickSightQTopics",
          ],
        },
        {
          "Label": {
            "default": "QuickSight Dataset Refresh Settings",
          },
          "Parameters": [
            "Frequency",
            "WeeklyRefreshDay",
            "MonthlyRefreshDay",
          ],
        },
        {
          "Label": {
            "default": "Log Level",
          },
          "Parameters": [
            "LogLevel",
          ],
        },
        {
          "Label": {
            "default": "Notifications",
          },
          "Parameters": [
            "EmailID",
            "CreateNewSolutionReleaseNotification",
          ],
        },
        {
          "Label": {
            "default": "Athena Configuration",
          },
          "Parameters": [
            "ThresholdValueForAthenaAlarm",
            "ThresholdUnitForAthenaAlarm",
          ],
        },
      ],
      "ParameterLabels": {
        "CreateNewSolutionReleaseNotification": {
          "default": "Receive notification when new version of the solution is released",
        },
        "CreateQuickSightQTopics": {
          "default": "Create Amazon Q Topics for QuickSight",
        },
        "CreateQuickSightUserGroups": {
          "default": "Create QuickSight User Groups",
        },
        "EmailID": {
          "default": "Email ID to receive QuickSight Dataset refresh alerts",
        },
        "Frequency": {
          "default": "Frequency for QuickSight Dataset refresh",
        },
        "LogLevel": {
          "default": "Log level for the lambda functions",
        },
        "MonthlyRefreshDay": {
          "default": "Day of the month for monthly refresh of QuickSight Dataset",
        },
        "QuickSightUserNameArn": {
          "default": "ARN for QuicksSight admin user",
        },
        "SecurityLakeAccountId": {
          "default": "Account Id where security lake is created",
        },
        "ThresholdUnitForAthenaAlarm": {
          "default": "Unit for threshold value for Athena Alarm",
        },
        "ThresholdValueForAthenaAlarm": {
          "default": "Threshold value in GB for Alarm on Athena WorkGroup",
        },
        "WeeklyRefreshDay": {
          "default": "Day of the week for weekly refresh of QuickSight Dataset",
        },
      },
    },
  },
  "Outputs": {
    "AppFabricSSMParameterUrl": {
      "Description": "Url to access AppFabric SSM Parameter",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "AWS::Region",
            },
            ".console.aws.amazon.com/systems-manager/parameters/solutions/securityInsights/",
            {
              "Ref": "AWS::Region",
            },
            "/appfabric/",
          ],
        ],
      },
    },
    "CloudtrailSSMParameterUrl": {
      "Description": "Url to access Cloudtrail SSM Parameter",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "AWS::Region",
            },
            ".console.aws.amazon.com/systems-manager/parameters/solutions/securityInsights/",
            {
              "Ref": "AWS::Region",
            },
            "/cloudtrail/",
          ],
        ],
      },
    },
    "SecurityHubSSMParameterUrl": {
      "Description": "Url to access SecurityHub SSM Parameter",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "AWS::Region",
            },
            ".console.aws.amazon.com/systems-manager/parameters/solutions/securityInsights/",
            {
              "Ref": "AWS::Region",
            },
            "/securityHub/",
          ],
        ],
      },
    },
    "SendAnonymizedData": {
      "Export": {
        "Name": {
          "Fn::Join": [
            "-",
            [
              "SendAnonymizedData",
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
      },
      "Value": {
        "Fn::FindInMap": [
          "Solution",
          "SolutionConfiguration",
          "SendAnonymizedUsageData",
        ],
      },
    },
    "SolutionID": {
      "Export": {
        "Name": {
          "Fn::Join": [
            "-",
            [
              "SolutionID",
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
      },
      "Value": {
        "Fn::FindInMap": [
          "Solution",
          "SolutionConfiguration",
          "ID",
        ],
      },
    },
    "SolutionVersion": {
      "Export": {
        "Name": {
          "Fn::Join": [
            "-",
            [
              "SolutionVersion",
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
      },
      "Value": {
        "Fn::FindInMap": [
          "Solution",
          "SolutionConfiguration",
          "Version",
        ],
      },
    },
    "UpdatePermissionsSSMParameterUrl": {
      "Description": "Url to access UpdatePermissions SSM Parameter",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "AWS::Region",
            },
            ".console.aws.amazon.com/systems-manager/parameters/solutions/securityInsights/",
            {
              "Ref": "AWS::Region",
            },
            "/updatePermissions/",
          ],
        ],
      },
    },
    "VpcFlowLogsSSMParameterUrl": {
      "Description": "Url to access VpcFlowLogs SSM Parameter",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "AWS::Region",
            },
            ".console.aws.amazon.com/systems-manager/parameters/solutions/securityInsights/",
            {
              "Ref": "AWS::Region",
            },
            "/vpcFlowLogs/",
          ],
        ],
      },
    },
  },
  "Parameters": {
    "CreateNewSolutionReleaseNotification": {
      "AllowedValues": [
        "No",
        "Yes",
      ],
      "Default": "Yes",
      "Description": "Select Yes to get notified when a new version of this solution is released.",
      "Type": "String",
    },
    "CreateQuickSightQTopics": {
      "AllowedValues": [
        "No",
        "Yes",
      ],
      "Default": "Yes",
      "Description": "Select Yes to create Amazon Q Topics for QuickSight. This allows you to query your data in natural language. Select No if your deployment region does not support Q",
      "Type": "String",
    },
    "CreateQuickSightUserGroups": {
      "AllowedValues": [
        "No",
        "Yes",
      ],
      "Default": "Yes",
      "Description": "Select Yes to create QuickSight User groups. If you use Identity Center to manage QuickSight User Groups, select No",
      "Type": "String",
    },
    "EmailID": {
      "AllowedPattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,}$",
      "Description": "Email ID to receive the QuickSight DataSet alerts",
      "Type": "String",
    },
    "Frequency": {
      "AllowedValues": [
        "Daily",
        "Weekly",
        "Monthly",
      ],
      "Default": "Weekly",
      "Description": "Frequency for dataset refresh",
      "Type": "String",
    },
    "LogLevel": {
      "AllowedValues": [
        "Info",
        "Debug",
        "Error",
        "Warn",
      ],
      "Default": "Info",
      "Description": "Log level for lambda functions",
      "Type": "String",
    },
    "MonthlyRefreshDay": {
      "AllowedValues": [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "10",
        "11",
        "12",
        "13",
        "14",
        "15",
        "16",
        "17",
        "18",
        "19",
        "20",
        "21",
        "22",
        "23",
        "24",
        "25",
        "26",
        "27",
        "28",
        "Last day of month",
      ],
      "Default": "1",
      "Description": "Day for monthly refresh of dataset. Select this option only if the Frequency is Monthly.",
      "Type": "String",
    },
    "QuickSightUserNameArn": {
      "AllowedPattern": "^arn:(.+):quicksight:(.+):(.+):user/(.+)$",
      "Description": "ARN for QuickSight username who will be the admin for this deployment",
      "Type": "String",
    },
    "SecurityLakeAccountId": {
      "Description": "Account Id in which Security Lake is created",
      "Type": "String",
    },
    "ThresholdUnitForAthenaAlarm": {
      "AllowedValues": [
        "GB",
        "TB",
        "PB",
        "EB",
      ],
      "Default": "GB",
      "Description": "Unit for threshold value for Athena Alarm",
      "Type": "String",
    },
    "ThresholdValueForAthenaAlarm": {
      "Default": 100,
      "Description": "Threshold value in GB for Athena Alarm",
      "Type": "Number",
    },
    "WeeklyRefreshDay": {
      "AllowedValues": [
        "Sunday",
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
      ],
      "Default": "Monday",
      "Description": "Day for weekly refresh of dataset. Select this option only if the Frequency is Weekly.",
      "Type": "String",
    },
  },
  "Resources": {
    "AppRegistry": {
      "Properties": {
        "Description": "Service Catalog application to track and manage all your resources for the solution security-insights-on-aws",
        "Name": {
          "Fn::Join": [
            "-",
            [
              "security-insights-on-aws",
              {
                "Ref": "AWS::Region",
              },
              {
                "Ref": "AWS::AccountId",
              },
            ],
          ],
        },
        "Tags": {
          "Solutions:ApplicationType": {
            "Fn::FindInMap": [
              "Solution",
              "SolutionConfiguration",
              "ApplicationType",
            ],
          },
          "Solutions:SolutionID": "SO0228",
          "Solutions:SolutionName": "security-insights-on-aws",
          "Solutions:SolutionVersion": "v2.0.2",
        },
      },
      "Type": "AWS::ServiceCatalogAppRegistry::Application",
    },
    "AthenaAlarmForDataScanned2F8599A2": {
      "DependsOn": [
        "AthenaExecutionNotificationsTopicPolicy9AA2156A",
        "AthenaExecutionNotificationsTopicD28243CC",
        "AthenaExecutionNotificationsTopicTokenSubscription1B93D6BB1",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Ref": "AthenaExecutionNotificationsTopicD28243CC",
          },
        ],
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "DatapointsToAlarm": 1,
        "Dimensions": [
          {
            "Name": "WorkGroup",
            "Value": {
              "Fn::Join": [
                "-",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "AthenaConfiguration",
                      "AthenaWorkgroupName",
                    ],
                  },
                  {
                    "Ref": "AWS::Region",
                  },
                ],
              ],
            },
          },
        ],
        "EvaluationPeriods": 1,
        "MetricName": "ProcessedBytes",
        "Namespace": "AWS/Athena",
        "Period": 86400,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Threshold": {
          "Fn::GetAtt": [
            "convertAthenaThresholdValueToBytesCustomResource",
            "ThresholdValueInBytes",
          ],
        },
        "TreatMissingData": "notBreaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "AthenaExecutionEventRule8E2EA903": {
      "Properties": {
        "EventPattern": {
          "detail": {
            "currentState": [
              "FAILED",
            ],
            "workgroupName": [
              {
                "Fn::Join": [
                  "-",
                  [
                    {
                      "Fn::FindInMap": [
                        "Solution",
                        "AthenaConfiguration",
                        "AthenaWorkgroupName",
                      ],
                    },
                    {
                      "Ref": "AWS::Region",
                    },
                  ],
                ],
              },
            ],
          },
          "detail-type": [
            "Athena Query State Change",
          ],
          "source": [
            "aws.athena",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Ref": "AthenaExecutionNotificationsTopicD28243CC",
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "AthenaExecutionNotificationsTopicD28243CC": {
      "Properties": {
        "DisplayName": "Notifications from Security Insights on AWS solution",
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "MyKMSKey652619A7",
            "Arn",
          ],
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "TopicName": {
          "Fn::Join": [
            "",
            [
              "SecurityInsightsnNotificationsTopic",
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
      },
      "Type": "AWS::SNS::Topic",
    },
    "AthenaExecutionNotificationsTopicPolicy9AA2156A": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
              "Resource": {
                "Ref": "AthenaExecutionNotificationsTopicD28243CC",
              },
              "Sid": "0",
            },
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Principal": {
                "Service": "cloudwatch.amazonaws.com",
              },
              "Resource": {
                "Ref": "AthenaExecutionNotificationsTopicD28243CC",
              },
              "Sid": "1",
            },
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Principal": {
                "Service": "ssm.amazonaws.com",
              },
              "Resource": {
                "Ref": "AthenaExecutionNotificationsTopicD28243CC",
              },
              "Sid": "2",
            },
          ],
          "Version": "2012-10-17",
        },
        "Topics": [
          {
            "Ref": "AthenaExecutionNotificationsTopicD28243CC",
          },
        ],
      },
      "Type": "AWS::SNS::TopicPolicy",
    },
    "AthenaExecutionNotificationsTopicTokenSubscription1B93D6BB1": {
      "Properties": {
        "Endpoint": {
          "Ref": "EmailID",
        },
        "Protocol": "email",
        "TopicArn": {
          "Ref": "AthenaExecutionNotificationsTopicD28243CC",
        },
      },
      "Type": "AWS::SNS::Subscription",
    },
    "AthenaMetricsEventRule2D98F036": {
      "Properties": {
        "EventPattern": {
          "detail": {
            "currentState": [
              "SUCCEEDED",
            ],
            "workgroupName": [
              {
                "Fn::Join": [
                  "-",
                  [
                    {
                      "Fn::FindInMap": [
                        "Solution",
                        "AthenaConfiguration",
                        "AthenaWorkgroupName",
                      ],
                    },
                    {
                      "Ref": "AWS::Region",
                    },
                  ],
                ],
              },
            ],
          },
          "detail-type": [
            "Athena Query State Change",
          ],
          "source": [
            "aws.athena",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "SendMetricsC28781AA",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "AthenaMetricsEventRuleAllowEventRuleSecurityInsightsStackSendMetrics4112645AE3AF7986": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "SendMetricsC28781AA",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "AthenaMetricsEventRule2D98F036",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "AthenaWorkGroupAD7AE63A": {
      "Properties": {
        "Description": "Athena WorkGroup for Security Insights Solution",
        "Name": {
          "Fn::Join": [
            "-",
            [
              {
                "Fn::FindInMap": [
                  "Solution",
                  "AthenaConfiguration",
                  "AthenaWorkgroupName",
                ],
              },
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
        "RecursiveDeleteOption": true,
        "State": "ENABLED",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "WorkGroupConfiguration": {
          "EnforceWorkGroupConfiguration": true,
          "PublishCloudWatchMetricsEnabled": true,
          "ResultConfiguration": {
            "EncryptionConfiguration": {
              "EncryptionOption": "SSE_S3",
            },
            "ExpectedBucketOwner": {
              "Ref": "AWS::AccountId",
            },
            "OutputLocation": {
              "Fn::Join": [
                "",
                [
                  "s3://",
                  {
                    "Ref": "AthenaWorkGroupAthenaWorkgroupBucket281C578F",
                  },
                  "/",
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "AthenaConfiguration",
                      "AthenaBucketPrefix",
                    ],
                  },
                ],
              ],
            },
          },
        },
      },
      "Type": "AWS::Athena::WorkGroup",
    },
    "AthenaWorkGroupAccessLoggingBucket86EB1CD3": {
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W35",
              "reason": " Access logging is not required for this bucket.",
            },
            {
              "id": "W51",
              "reason": "Policy is not required for this bucket.",
            },
          ],
        },
      },
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "LifecycleConfiguration": {
          "Rules": [
            {
              "ExpirationInDays": 180,
              "Id": "DeletionRule",
              "Status": "Enabled",
            },
          ],
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "ObjectWriter",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "AthenaWorkGroupAccessLoggingBucketPolicyF1C7909C": {
      "Properties": {
        "Bucket": {
          "Ref": "AthenaWorkGroupAccessLoggingBucket86EB1CD3",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AthenaWorkGroupAccessLoggingBucket86EB1CD3",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "AthenaWorkGroupAccessLoggingBucket86EB1CD3",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "AthenaWorkGroupAthenaWorkgroupBucket281C578F": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "BucketName": {
          "Fn::Join": [
            "-",
            [
              {
                "Fn::FindInMap": [
                  "Solution",
                  "AthenaConfiguration",
                  "AthenaWorkgroupBucketName",
                ],
              },
              {
                "Fn::Select": [
                  0,
                  {
                    "Fn::Split": [
                      "-",
                      {
                        "Fn::Select": [
                          2,
                          {
                            "Fn::Split": [
                              "/",
                              {
                                "Ref": "AWS::StackId",
                              },
                            ],
                          },
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          ],
        },
        "LifecycleConfiguration": {
          "Rules": [
            {
              "ExpirationInDays": 180,
              "Id": "DeletionRule",
              "Status": "Enabled",
            },
          ],
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "AthenaWorkGroupAccessLoggingBucket86EB1CD3",
          },
          "LogFilePrefix": "athena_results/",
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "AthenaWorkGroupAthenaWorkgroupBucketPolicy58ABA925": {
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W51",
              "reason": "Policy is not required for this bucket.",
            },
          ],
        },
      },
      "Properties": {
        "Bucket": {
          "Ref": "AthenaWorkGroupAthenaWorkgroupBucket281C578F",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AthenaWorkGroupAthenaWorkgroupBucket281C578F",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "AthenaWorkGroupAthenaWorkgroupBucket281C578F",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "CloudTrailTopic": {
      "Condition": "CreateQuickSightQTopicsCondition",
      "DependsOn": [
        "createQuickSightDataSetRefreshSchedulesCustomResource",
      ],
      "Properties": {
        "AwsAccountId": {
          "Ref": "AWS::AccountId",
        },
        "DataSets": [
          {
            "CalculatedFields": [
              {
                "CalculatedFieldDescription": "",
                "CalculatedFieldName": "Username",
                "CalculatedFieldSynonyms": [
                  "actor name",
                  "actor",
                ],
                "ColumnDataRole": "DIMENSION",
                "Expression": "coalesce({User_Name},{Actor_User_Name})",
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "CalculatedFieldDescription": "",
                "CalculatedFieldName": "UId",
                "CalculatedFieldSynonyms": [
                  "arn",
                  "user arn",
                  "unique id",
                  "userarn",
                  "actor",
                ],
                "ColumnDataRole": "DIMENSION",
                "Expression": "coalesce({Actor_UId},{User_UId})",
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
            ],
            "Columns": [
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Record",
                "ColumnName": "Record_Id",
                "ColumnSynonyms": [
                  "Event",
                  "document",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Identifier",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Product Name",
                "ColumnName": "Product_Name",
                "ColumnSynonyms": [
                  "software name",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Organization",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Timestamp",
                "ColumnName": "Timestamp",
                "ColumnSynonyms": [
                  "date",
                  "time",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Date",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Event Code",
                "ColumnName": "Event_Code",
                "ColumnSynonyms": [
                  "activity code",
                  "action code",
                  "incident code",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Api Operation",
                "ColumnName": "Api_Operation",
                "ColumnSynonyms": [
                  "api",
                  "operation",
                  "api call",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Cloud Provider",
                "ColumnName": "Cloud_Provider",
                "ColumnSynonyms": [
                  "cloud supplier",
                  "cloud vendor",
                  "cloud company",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Organization",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Service",
                "ColumnName": "Service",
                "ColumnSynonyms": [
                  "provision",
                  "support",
                  "system",
                  "aws service",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Actor User Type",
                "ColumnName": "Actor_User_Type",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Actor User Name",
                "ColumnName": "Actor_User_Name",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Actor UId",
                "ColumnName": "Actor_UId",
                "ColumnSynonyms": [
                  "a u id",
                  "performer u id",
                  "agent u id",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "User Name",
                "ColumnName": "User_Name",
                "ColumnSynonyms": [
                  "client name",
                  "customer name",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "User UId",
                "ColumnName": "User_UId",
                "ColumnSynonyms": [
                  "subscriber",
                  "client",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Is Cross Account",
                "ColumnName": "Is_Cross_Account",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "User Agent",
                "ColumnName": "User_Agent",
                "ColumnSynonyms": [
                  "client agent",
                  "employee agent",
                  "owner agent",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Source IP",
                "ColumnName": "Source_IP",
                "ColumnSynonyms": [
                  "ip",
                  "ip address",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "MEASURE",
                "ColumnDescription": "",
                "ColumnFriendlyName": "MFA Used",
                "ColumnName": "MFA_Used",
                "ColumnSynonyms": [
                  "mfa utilised",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Class",
                "ColumnName": "Class",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Category",
                "ColumnName": "Category",
                "ColumnSynonyms": [
                  "classification",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Activity",
                "ColumnName": "Activity",
                "ColumnSynonyms": [
                  "action",
                  "operation",
                  "occurrence",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Type",
                "ColumnName": "Type",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Severity",
                "ColumnName": "Severity",
                "ColumnSynonyms": [
                  "seriousness",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Status",
                "ColumnName": "Status",
                "ColumnSynonyms": [
                  "situation",
                  "result",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Account Id",
                "ColumnName": "Account_Id",
                "ColumnSynonyms": [
                  "acount",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Identifier",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Region",
                "ColumnName": "Region",
                "ColumnSynonyms": [
                  "area",
                  "territory",
                  "geography",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "SubTypeName": "Level200",
                  "TypeName": "Location",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Email Address",
                "ColumnName": "Email_Address",
                "ColumnSynonyms": [
                  "email",
                  "email id",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Geo Location",
                "ColumnName": "Geo_Location",
                "ColumnSynonyms": [
                  "geographic region",
                  "geographic location",
                  "geography location",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
            ],
            "DatasetArn": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":quicksight:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":dataset/Security_Insights_Cloudtrail_Dataset",
                ],
              ],
            },
            "DatasetName": "Security_Insights_Cloudtrail_Dataset",
            "NamedEntities": [
              {
                "Definition": [
                  {
                    "FieldName": "Record_Id",
                  },
                  {
                    "FieldName": "Status",
                  },
                  {
                    "FieldName": "Timestamp",
                  },
                  {
                    "FieldName": "UId",
                  },
                  {
                    "FieldName": "Region",
                  },
                  {
                    "FieldName": "Account_Id",
                  },
                  {
                    "FieldName": "Type",
                  },
                  {
                    "FieldName": "Activity",
                  },
                  {
                    "FieldName": "Actor_User_Type",
                  },
                  {
                    "FieldName": "Category",
                  },
                  {
                    "FieldName": "Class",
                  },
                  {
                    "FieldName": "Cloud_Provider",
                  },
                  {
                    "FieldName": "Email_Address",
                  },
                  {
                    "FieldName": "Product_Name",
                  },
                  {
                    "FieldName": "Geo_Location",
                  },
                  {
                    "FieldName": "Is_Cross_Account",
                  },
                  {
                    "FieldName": "MFA_Used",
                  },
                  {
                    "FieldName": "Service",
                  },
                  {
                    "FieldName": "Severity",
                  },
                  {
                    "FieldName": "Source_IP",
                  },
                  {
                    "FieldName": "Username",
                  },
                  {
                    "FieldName": "User_Agent",
                  },
                  {
                    "FieldName": "Api_Operation",
                  },
                ],
                "EntityDescription": "Details for the results from CloudTrail table.",
                "EntityName": "CloudTrail Records",
                "EntitySynonyms": [],
              },
            ],
          },
        ],
        "Description": "This is a topic for CloudTrail data source",
        "Name": "SecurityInsights-CloudTrailTopic",
        "TopicId": "SecurityInsights-CloudTrailTopic",
        "UserExperienceVersion": "NEW_READER_EXPERIENCE",
      },
      "Type": "AWS::QuickSight::Topic",
    },
    "ConvertAthenaThresholdValueToBytes123E1678": {
      "DependsOn": [
        "ConvertAthenaThresholdValueToBytesRoleEF4061A2",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/setAthenaThresholdValue.zip",
        },
        "Description": "Lambda function to convert Athena threshold value to bytes",
        "Environment": {
          "Variables": {
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
            "USER_AGENT_STRING": {
              "Fn::Sub": [
                "AWSSOLUTION/\${SolutionID}/\${Version}",
                {
                  "SolutionID": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "ID",
                    ],
                  },
                  "Version": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "Version",
                    ],
                  },
                },
              ],
            },
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "ReservedConcurrentExecutions": 1,
        "Role": {
          "Fn::GetAtt": [
            "ConvertAthenaThresholdValueToBytesRoleEF4061A2",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 300,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "ConvertAthenaThresholdValueToBytesLogGroup9C2F0C8C": {
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "ConvertAthenaThresholdValueToBytes123E1678",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "ConvertAthenaThresholdValueToBytesRoleEF4061A2": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "ConvertAthenaThresholdValueToBytesRolePolicy8B5CD36A": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
              "Sid": "LamdaLogGroupPolicyStatement",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ConvertAthenaThresholdValueToBytesRolePolicy8B5CD36A",
        "Roles": [
          {
            "Ref": "ConvertAthenaThresholdValueToBytesRoleEF4061A2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CreateLakeFormationPermissionsAwsEventsLambdaInvokePermission15044E4D8": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CreateLakeFormationPermissionsB22A0089",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "UpdatePermissionsForTablesEventsRule830DFE79",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CreateLakeFormationPermissionsB22A0089": {
      "DependsOn": [
        "SetupLakeFormationPermissionsRoleB563CC38",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/createLakeFormationPermissions.zip",
        },
        "Description": "Lambda function to create LakeFormation Permissions",
        "Environment": {
          "Variables": {
            "CREATE_USER_GROUPS": {
              "Ref": "CreateQuickSightUserGroups",
            },
            "CURRENT_ACCOUNT_ID": {
              "Ref": "AWS::AccountId",
            },
            "DEFAULT_CLOUDTRAIL_DATATABLE_NAME": "cloudtrail",
            "DEFAULT_DATABASE_NAME": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "DEFAULT_SECURITY_HUB_DATATABLE_NAME": "sh",
            "DEFAULT_VPC_DATATABLE_NAME": "vpc",
            "DELAY_IN_SECONDS_FOR_RATE_LIMITING": "1",
            "LAMBDA_EXECUTION_ROLE_ARN": {
              "Fn::GetAtt": [
                "SetupLakeFormationPermissionsRoleB563CC38",
                "Arn",
              ],
            },
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
            "QUICKSIGHT_ADMIN_USER": {
              "Ref": "QuickSightUserNameArn",
            },
            "QUICKSIGHT_ADMIN_USER_GROUP_ARN": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":quicksight:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":group/default/",
                  {
                    "Fn::Join": [
                      "-",
                      [
                        {
                          "Fn::FindInMap": [
                            "Solution",
                            "QuickSightConfiguration",
                            "AdminUserGroupName",
                          ],
                        },
                        {
                          "Ref": "AWS::Region",
                        },
                      ],
                    ],
                  },
                ],
              ],
            },
            "QUICKSIGHT_READ_USER_GROUP_ARN": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":quicksight:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":group/default/",
                  {
                    "Fn::Join": [
                      "-",
                      [
                        {
                          "Fn::FindInMap": [
                            "Solution",
                            "QuickSightConfiguration",
                            "ReadUserGroupName",
                          ],
                        },
                        {
                          "Ref": "AWS::Region",
                        },
                      ],
                    ],
                  },
                ],
              ],
            },
            "QUICKSIGHT_SERVICE_ROLE": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":iam::",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":role/service-role/",
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "QuickSightConfiguration",
                      "QuickSightServiceLinkedRoleName",
                    ],
                  },
                ],
              ],
            },
            "REGION": {
              "Ref": "AWS::Region",
            },
            "RESOURCE_LINK_DATABASE_NAME": {
              "Ref": "glueResourceLinkDatabaseGlueDB3E8E6ADB",
            },
            "ROLLUP_REGION": {
              "Ref": "AWS::Region",
            },
            "SECURITY_LAKE_ACCOUNT_ID": {
              "Ref": "SecurityLakeAccountId",
            },
            "SECURITY_LAKE_APP_FABRIC_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeAppFabricTableName",
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_CLOUDTRAIL_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeCloudtrailTableName",
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_DATABASE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeDatabasePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_SECURITY_HUB_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeSecurityHubTableName",
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_VPC_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeVpcTableName",
                    ],
                  },
                ],
              ],
            },
            "USER_AGENT_STRING": {
              "Fn::Sub": [
                "AWSSOLUTION/\${SolutionID}/\${Version}",
                {
                  "SolutionID": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "ID",
                    ],
                  },
                  "Version": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "Version",
                    ],
                  },
                },
              ],
            },
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "ReservedConcurrentExecutions": 1,
        "Role": {
          "Fn::GetAtt": [
            "SetupLakeFormationPermissionsRoleB563CC38",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 300,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "CreateLakeFormationPermissionsCustomResource": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CreateLakeFormationPermissionsLogGroupB22E0017",
        "SetupLakeFormationPermissionsPolicy05021B38",
      ],
      "Properties": {
        "AccountId": {
          "Ref": "AWS::AccountId",
        },
        "CreateQuickSightUserGrous": {
          "Ref": "CreateQuickSightUserGroups",
        },
        "QuickSightAdminArn": {
          "Ref": "QuickSightUserNameArn",
        },
        "Region": {
          "Ref": "AWS::Region",
        },
        "SecurityLakeAccount": {
          "Ref": "SecurityLakeAccountId",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "CreateLakeFormationPermissionsB22A0089",
            "Arn",
          ],
        },
      },
      "Type": "Custom::CreateLakeFormationPermissions",
      "UpdateReplacePolicy": "Delete",
    },
    "CreateLakeFormationPermissionsLogGroupB22E0017": {
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "CreateLakeFormationPermissionsB22A0089",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "CreateQuickDataSetLogGroup0C2D914E": {
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "CreateQuickDataSets875AE2C0",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "CreateQuickDataSets875AE2C0": {
      "DependsOn": [
        "CreateQuickSightDataSetsRoleB4AE7AA1",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/createQuickSightDataSets.zip",
        },
        "Description": "Lambda function to create data and update data sets for QuickSight",
        "Environment": {
          "Variables": {
            "APP_FABRIC_SSM_PARAMETER_NAME": {
              "Fn::Join": [
                "",
                [
                  "/solutions/securityInsights/",
                  {
                    "Ref": "AWS::Region",
                  },
                  "/appfabric",
                ],
              ],
            },
            "ATHENA_WORKGROUP_NAME": {
              "Fn::Join": [
                "-",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "AthenaConfiguration",
                      "AthenaWorkgroupName",
                    ],
                  },
                  {
                    "Ref": "AWS::Region",
                  },
                ],
              ],
            },
            "CLOUDTRAIL_SSM_PARAMETER_NAME": {
              "Fn::Join": [
                "",
                [
                  "/solutions/securityInsights/",
                  {
                    "Ref": "AWS::Region",
                  },
                  "/cloudtrail",
                ],
              ],
            },
            "CURRENT_ACCOUNT_ID": {
              "Ref": "AWS::AccountId",
            },
            "DATA_SOURCE_ARN": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":quicksight:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":datasource/",
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "QuickSightConfiguration",
                      "QuickSightDataSourceId",
                    ],
                  },
                ],
              ],
            },
            "DEFAULT_APP_FABRIC_DATATABLE_NAME": "appfabric",
            "DEFAULT_CLOUDTRAIL_DATATABLE_NAME": "cloudtrail",
            "DEFAULT_DATABASE_NAME": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "DEFAULT_QUERY_WINDOW_DURATION": {
              "Fn::FindInMap": [
                "Solution",
                "SecurityLakeConfiguration",
                "DefaultQueryWindowDuration",
              ],
            },
            "DEFAULT_SECURITY_HUB_DATATABLE_NAME": "sh",
            "DEFAULT_VPC_DATATABLE_NAME": "vpc",
            "DELAY_IN_SECONDS_FOR_DATA_SOURCE_CREATION": "10",
            "DELAY_IN_SECONDS_FOR_DATA_SOURCE_UPDATE": "120",
            "DELAY_IN_SECONDS_FOR_RATE_LIMITING": "1",
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
            "METRICS_ENDPOINT": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "MetricsURL",
              ],
            },
            "QUICKSIGHT_PRINCIPAL_ARN": {
              "Ref": "QuickSightUserNameArn",
            },
            "QUICKSIGHT_SERVICE_LINKED_ROLE": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":iam::",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":role/service-role/",
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "QuickSightConfiguration",
                      "QuickSightServiceLinkedRoleName",
                    ],
                  },
                ],
              ],
            },
            "REGION": {
              "Ref": "AWS::Region",
            },
            "RESOURCE_LINK_DATABASE_NAME": {
              "Fn::FindInMap": [
                "Solution",
                "SecurityLakeConfiguration",
                "ResourceLinkDatabase",
              ],
            },
            "ROLLUP_REGION": {
              "Ref": "AWS::Region",
            },
            "SECURITY_HUB_SSM_PARAMETER_NAME": {
              "Fn::Join": [
                "",
                [
                  "/solutions/securityInsights/",
                  {
                    "Ref": "AWS::Region",
                  },
                  "/securityHub",
                ],
              ],
            },
            "SECURITY_LAKE_ACCOUNT_ID": {
              "Ref": "SecurityLakeAccountId",
            },
            "SECURITY_LAKE_APP_FABRIC_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeAppFabricTableName",
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_CLOUDTRAIL_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeCloudtrailTableName",
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_DATABASE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeDatabasePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_SECURITY_HUB_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeSecurityHubTableName",
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_VPC_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeVpcTableName",
                    ],
                  },
                ],
              ],
            },
            "SEND_METRIC": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "SendAnonymizedUsageData",
              ],
            },
            "SOLUTION_ID": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "ID",
              ],
            },
            "SOLUTION_VERSION": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "Version",
              ],
            },
            "USER_AGENT_STRING": {
              "Fn::Sub": [
                "AWSSOLUTION/\${SolutionID}/\${Version}",
                {
                  "SolutionID": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "ID",
                    ],
                  },
                  "Version": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "Version",
                    ],
                  },
                },
              ],
            },
            "UUID": {
              "Fn::GetAtt": [
                "UUIDGenerator",
                "UUID",
              ],
            },
            "VPC_FLOW_LOGS_SSM_PARAMETER_NAME": {
              "Fn::Join": [
                "",
                [
                  "/solutions/securityInsights/",
                  {
                    "Ref": "AWS::Region",
                  },
                  "/vpcFlowLogs",
                ],
              ],
            },
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "ReservedConcurrentExecutions": 4,
        "Role": {
          "Fn::GetAtt": [
            "CreateQuickSightDataSetsRoleB4AE7AA1",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 300,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "CreateQuickDataSetsAwsEventsLambdaInvokePermission1D512D360": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CreateQuickDataSets875AE2C0",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "EventsRuleLambdaEventsRule0A996B52",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CreateQuickSightDataSetRefreshSchedules57C4A1CD": {
      "DependsOn": [
        "CreateQuickSightDataSetRefreshSchedulesRoleFB1B08AB",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/createQuickSightDataSetRefreshSchedules.zip",
        },
        "Description": "Lambda function to create refresh schedule for quicksight datasets",
        "Environment": {
          "Variables": {
            "ATHENA_WORKGROUP_NAME": {
              "Fn::Join": [
                "-",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "AthenaConfiguration",
                      "AthenaWorkgroupName",
                    ],
                  },
                  {
                    "Ref": "AWS::Region",
                  },
                ],
              ],
            },
            "DATA_SOURCE_ARN": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":quicksight:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":datasource/",
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "QuickSightConfiguration",
                      "QuickSightDataSourceId",
                    ],
                  },
                ],
              ],
            },
            "DEFAULT_CLOUDTRAIL_DATATABLE_NAME": "cloudtrail",
            "DEFAULT_DATABASE_NAME": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "DEFAULT_QUERY_WINDOW_DURATION": {
              "Fn::FindInMap": [
                "Solution",
                "SecurityLakeConfiguration",
                "DefaultQueryWindowDuration",
              ],
            },
            "DEFAULT_SECURITY_HUB_DATATABLE_NAME": "sh",
            "DEFAULT_VPC_DATATABLE_NAME": "vpc",
            "DELAY_IN_SECONDS_FOR_RATE_LIMITING": "1",
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
            "QUICKSIGHT_PRINCIPAL_ARN": {
              "Ref": "QuickSightUserNameArn",
            },
            "QUICKSIGHT_SERVICE_LINKED_ROLE": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":iam::",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":role/service-role/",
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "QuickSightConfiguration",
                      "QuickSightServiceLinkedRoleName",
                    ],
                  },
                ],
              ],
            },
            "REGION": {
              "Ref": "AWS::Region",
            },
            "ROLLUP_REGION": {
              "Ref": "AWS::Region",
            },
            "SECURITY_LAKE_CLOUDTRAIL_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeCloudtrailTableName",
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_DATABASE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeDatabasePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_SECURITY_HUB_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeSecurityHubTableName",
                    ],
                  },
                ],
              ],
            },
            "SECURITY_LAKE_VPC_TABLE_NAME": {
              "Fn::Join": [
                "_",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeTablePrefix",
                    ],
                  },
                  {
                    "Fn::Join": [
                      "_",
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "SecurityLakeConfiguration",
                      "SecurityLakeVpcTableName",
                    ],
                  },
                ],
              ],
            },
            "USER_AGENT_STRING": {
              "Fn::Sub": [
                "AWSSOLUTION/\${SolutionID}/\${Version}",
                {
                  "SolutionID": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "ID",
                    ],
                  },
                  "Version": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "Version",
                    ],
                  },
                },
              ],
            },
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "ReservedConcurrentExecutions": 1,
        "Role": {
          "Fn::GetAtt": [
            "CreateQuickSightDataSetRefreshSchedulesRoleFB1B08AB",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 300,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "CreateQuickSightDataSetRefreshSchedulesLogGroupECB1BA2C": {
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "CreateQuickSightDataSetRefreshSchedules57C4A1CD",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "CreateQuickSightDataSetRefreshSchedulesRoleFB1B08AB": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CreateQuickSightDataSetRefreshSchedulesRolePolicyD365A7D5": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "quicksight:CreateRefreshSchedule",
                "quicksight:DeleteRefreshSchedule",
                "quicksight:UpdateRefreshSchedule",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Apps_Failed_Logins/refresh-schedule/Security_Insights_AppFabric_Apps_Failed_Logins",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_IP_Address_Logins/refresh-schedule/Security_Insights_AppFabric_IP_Address_Logins",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Logins_By_Applications/refresh-schedule/Security_Insights_AppFabric_Logins_By_Applications",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Suspicious_Logins/refresh-schedule/Security_Insights_AppFabric_Suspicious_Logins",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Cloudtrail_Dataset/refresh-schedule/Security_Insights_Cloudtrail_Dataset",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Security_Hub_Dataset/refresh-schedule/Security_Insights_Security_Hub_Dataset",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_VPC_Flow_Dataset/refresh-schedule/Security_Insights_VPC_Flow_Dataset",
                    ],
                  ],
                },
              ],
              "Sid": "AllowQuickSightDataSetRefreshSchedules",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
              "Sid": "LamdaLogGroupPolicyStatement",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "XrayPolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreateQuickSightDataSetRefreshSchedulesRolePolicyD365A7D5",
        "Roles": [
          {
            "Ref": "CreateQuickSightDataSetRefreshSchedulesRoleFB1B08AB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CreateQuickSightDataSetsRoleB4AE7AA1": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CreateQuickSightDataSetsRoleCreatePolicy2EF85EB5": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "quicksight:DescribeDataSet",
                "quicksight:DescribeDataSetPermissions",
                "quicksight:PassDataSet",
                "quicksight:DeleteDataSet",
                "quicksight:UpdateDataSetPermissions",
                "quicksight:CreateDataSet",
                "quicksight:UpdateDataSet",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Apps_Failed_Logins",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_IP_Address_Logins",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Logins_By_Applications",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Suspicious_Logins",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Cloudtrail_Dataset",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Security_Hub_Dataset",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_VPC_Flow_Dataset",
                    ],
                  ],
                },
              ],
              "Sid": "QuickSightDataSetPermissions",
            },
            {
              "Action": "quicksight:ListIngestions",
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ListQuickSightIngestions",
            },
            {
              "Action": [
                "quicksight:DescribeIngestion",
                "quicksight:CreateIngestion",
                "quicksight:CancelIngestion",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Apps_Failed_Logins/ingestion/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_IP_Address_Logins/ingestion/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Logins_By_Applications/ingestion/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Suspicious_Logins/ingestion/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Cloudtrail_Dataset/ingestion/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Security_Hub_Dataset/ingestion/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_VPC_Flow_Dataset/ingestion/*",
                    ],
                  ],
                },
              ],
              "Sid": "QuickSightIngestionPermissions",
            },
            {
              "Action": "quicksight:CreateDataSource",
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "QuickSightCreateDataSource",
            },
            {
              "Action": [
                "quicksight:UpdateDataSourcePermissions",
                "quicksight:DescribeDataSource",
                "quicksight:DescribeDataSourcePermissions",
                "quicksight:PassDataSource",
                "quicksight:UpdateDataSource",
                "quicksight:DeleteDataSource",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":quicksight:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":datasource/",
                    {
                      "Fn::FindInMap": [
                        "Solution",
                        "QuickSightConfiguration",
                        "QuickSightDataSourceId",
                      ],
                    },
                  ],
                ],
              },
              "Sid": "QuickSightDataSourcePermissions",
            },
            {
              "Action": "ssm:GetParameter",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametervpcFlowLogsBF597E17",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametercloudtrail552F6505",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametersecurityHub8017A884",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParameterappfabricA8D61F4D",
                      },
                    ],
                  ],
                },
              ],
              "Sid": "AllowSSMAccess",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreateQuickSightDataSetsRoleCreatePolicy2EF85EB5",
        "Roles": [
          {
            "Ref": "CreateQuickSightDataSetsRoleB4AE7AA1",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CreateQuickSightDataSetsRoleUpdatePolicyE2C9043E": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "quicksight:UpdateDataSet",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":quicksight:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":datasource/",
                    {
                      "Fn::FindInMap": [
                        "Solution",
                        "QuickSightConfiguration",
                        "QuickSightDataSourceId",
                      ],
                    },
                  ],
                ],
              },
              "Sid": "QuickSightUpdateDataSetPermissionsForDataSource",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreateQuickSightDataSetsRoleUpdatePolicyE2C9043E",
        "Roles": [
          {
            "Ref": "CreateQuickSightDataSetsRoleB4AE7AA1",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CreateReleaseNotificationSchedulerRoleEA21E02B": {
      "Condition": "CreateSolutionReleaseNotificationCondition",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "scheduler.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CreateReleaseNotificationSchedulerRolePolicy186FFFF9": {
      "Condition": "CreateSolutionReleaseNotificationCondition",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "CreateSolutionReleaseNotificationFunction93A179B7",
                  "Arn",
                ],
              },
              "Sid": "InvokeLambda",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreateReleaseNotificationSchedulerRolePolicy186FFFF9",
        "Roles": [
          {
            "Ref": "CreateReleaseNotificationSchedulerRoleEA21E02B",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CreateSolutionReleaseNotificationFunction93A179B7": {
      "Condition": "CreateSolutionReleaseNotificationCondition",
      "DependsOn": [
        "CreateSolutionReleaseNotificationRoleA1D8279B",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/createSolutionReleaseNotification.zip",
        },
        "Description": "Lambda function to create new release notifications",
        "Environment": {
          "Variables": {
            "APPLICATION_TAG_KEY": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagKey",
              ],
            },
            "APPLICATION_TAG_VALUE": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
            "CREATE_QUICKSIGHT_DATASETS_LAMBDA_FUNCTION_ARN": {
              "Fn::GetAtt": [
                "CreateQuickDataSets875AE2C0",
                "Arn",
              ],
            },
            "CURRENT_RELEASE_TAG": "release/v2.0.2",
            "DELAY_IN_SECONDS_FOR_RATE_LIMITING": "1",
            "LAMBDA_EXECUTION_ROLE_ARN": {
              "Fn::GetAtt": [
                "SetupLakeFormationPermissionsRoleB563CC38",
                "Arn",
              ],
            },
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
            "REGION": {
              "Ref": "AWS::Region",
            },
            "SNS_TOPIC_ARN": {
              "Ref": "AthenaExecutionNotificationsTopicD28243CC",
            },
            "SOLUTION_GIT_REPO_URL": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "GitHubRepoUrl",
              ],
            },
            "USER_AGENT_STRING": {
              "Fn::Sub": [
                "AWSSOLUTION/\${SolutionID}/\${Version}",
                {
                  "SolutionID": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "ID",
                    ],
                  },
                  "Version": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "Version",
                    ],
                  },
                },
              ],
            },
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "ReservedConcurrentExecutions": 1,
        "Role": {
          "Fn::GetAtt": [
            "CreateSolutionReleaseNotificationRoleA1D8279B",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 300,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "CreateSolutionReleaseNotificationFunctionLogGroupC2B12478": {
      "Condition": "CreateSolutionReleaseNotificationCondition",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "CreateSolutionReleaseNotificationFunction93A179B7",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "CreateSolutionReleaseNotificationRoleA1D8279B": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CreateSolutionReleaseNotificationRolePolicy340834C6": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssm:CreateOpsItem",
                "ssm:DescribeOpsItems",
                "ssm:AddTagsToResource",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "createOpsItems",
            },
            {
              "Action": [
                "ssm:AssociateOpsItemRelatedItem",
                "ssm:UpdateOpsItem",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":opsitem/*",
                  ],
                ],
              },
              "Sid": "updateOpsItems",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreateSolutionReleaseNotificationRolePolicy340834C6",
        "Roles": [
          {
            "Ref": "CreateSolutionReleaseNotificationRoleA1D8279B",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "EventsRuleLambdaEventsRule0A996B52": {
      "Properties": {
        "EventPattern": {
          "detail-type": [
            "Parameter Store Change",
          ],
          "resources": [
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "SsmParametervpcFlowLogsBF597E17",
                  },
                ],
              ],
            },
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "SsmParametercloudtrail552F6505",
                  },
                ],
              ],
            },
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "SsmParametersecurityHub8017A884",
                  },
                ],
              ],
            },
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "SsmParameterappfabricA8D61F4D",
                  },
                ],
              ],
            },
          ],
          "source": [
            "aws.ssm",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "CreateQuickDataSets875AE2C0",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "GlueDatabaseGlueDB33F3ED0A": {
      "Properties": {
        "CatalogId": {
          "Ref": "AWS::AccountId",
        },
        "DatabaseInput": {
          "Name": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "Solution",
                    "GlueConfiguration",
                    "GlueDatabaseName",
                  ],
                },
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
        },
      },
      "Type": "AWS::Glue::Database",
    },
    "GlueDatabaseGlueDatabasePermissionquickSightAdminE74E1036": {
      "Properties": {
        "Permissions": [
          "DESCRIBE",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Ref": "QuickSightUserNameArn",
          },
        },
        "Resource": {
          "Database": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "Name": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueDatabaseGlueDatabasePermissionquickSightServiceLinkedRole38BCC7ED": {
      "Properties": {
        "Permissions": [
          "DESCRIBE",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::",
                {
                  "Ref": "AWS::AccountId",
                },
                ":role/service-role/",
                {
                  "Fn::FindInMap": [
                    "Solution",
                    "QuickSightConfiguration",
                    "QuickSightServiceLinkedRoleName",
                  ],
                },
              ],
            ],
          },
        },
        "Resource": {
          "Database": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "Name": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTableappfabricGluePermissionappfabricquickSightAdminA411B0E9": {
      "Properties": {
        "Permissions": [
          "SELECT",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Ref": "QuickSightUserNameArn",
          },
        },
        "Resource": {
          "Table": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "DatabaseName": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "Name": {
              "Ref": "GlueTableappfabricGlueTable061CAA50",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTableappfabricGluePermissionappfabricquickSightServiceLinkedRole4029B9A1": {
      "Properties": {
        "Permissions": [
          "SELECT",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::",
                {
                  "Ref": "AWS::AccountId",
                },
                ":role/service-role/",
                {
                  "Fn::FindInMap": [
                    "Solution",
                    "QuickSightConfiguration",
                    "QuickSightServiceLinkedRoleName",
                  ],
                },
              ],
            ],
          },
        },
        "Resource": {
          "Table": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "DatabaseName": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "Name": {
              "Ref": "GlueTableappfabricGlueTable061CAA50",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTableappfabricGlueTable061CAA50": {
      "Properties": {
        "CatalogId": {
          "Ref": "AWS::AccountId",
        },
        "DatabaseName": {
          "Ref": "GlueDatabaseGlueDB33F3ED0A",
        },
        "TableInput": {
          "Description": "Glue placeholder table for appfabric",
          "Name": "appfabric",
          "Parameters": {
            "classification": "parquet",
            "has_encrypted_data": true,
          },
          "StorageDescriptor": {
            "Columns": [
              {
                "Name": "activity_id",
                "Type": "string",
              },
              {
                "Name": "activity_name",
                "Type": "string",
              },
              {
                "Name": "actor",
                "Type": "struct<session:struct<created_time:bigint,uid:string,issuer:string>,user:struct<uid:string,email_addr:string,credential_uid:string,name:string,type:string>>",
              },
              {
                "Name": "user",
                "Type": "struct<uid:string,email_addr:string,credential_uid:string,name:string,type:string>",
              },
              {
                "Name": "group",
                "Type": "struct<uid:string,desc:string,name:string,type:string,privileges:array<string>>",
              },
              {
                "Name": "privileges",
                "Type": "array<string>",
              },
              {
                "Name": "web_resources",
                "Type": "array<struct<type:string,uid:string,name:string,data:struct<current_value:string,previous_value:string>>>",
              },
              {
                "Name": "http_request",
                "Type": "struct<http_method:string,user_agent:string,url:string>",
              },
              {
                "Name": "auth_protocol",
                "Type": "string",
              },
              {
                "Name": "auth_protocol_id",
                "Type": "int",
              },
              {
                "Name": "category_name",
                "Type": "string",
              },
              {
                "Name": "category_uid",
                "Type": "string",
              },
              {
                "Name": "class_name",
                "Type": "string",
              },
              {
                "Name": "class_uid",
                "Type": "string",
              },
              {
                "Name": "is_mfa",
                "Type": "boolean",
              },
              {
                "Name": "raw_data",
                "Type": "string",
              },
              {
                "Name": "severity",
                "Type": "string",
              },
              {
                "Name": "severity_id",
                "Type": "int",
              },
              {
                "Name": "status",
                "Type": "string",
              },
              {
                "Name": "status_detail",
                "Type": "string",
              },
              {
                "Name": "status_id",
                "Type": "int",
              },
              {
                "Name": "time",
                "Type": "bigint",
              },
              {
                "Name": "type_name",
                "Type": "string",
              },
              {
                "Name": "type_uid",
                "Type": "string",
              },
              {
                "Name": "description",
                "Type": "string",
              },
              {
                "Name": "metadata",
                "Type": "struct<product:struct<uid:string,vendor_name:string,name:string>,processed_time:string,version:string,uid:string,event_code:string>",
              },
              {
                "Name": "device",
                "Type": "struct<uid:string,hostname:string,ip:string,name:string,region:string,type:string,os:struct<name:string,type:string,version:string>,location:struct<coordinates:array<float>,city:string,state:string,country:string,postal_code:string,continent:string,desc:string>>",
              },
              {
                "Name": "unmapped",
                "Type": "map<string,string>",
              },
              {
                "Name": "region",
                "Type": "string",
              },
              {
                "Name": "accountid",
                "Type": "string",
              },
              {
                "Name": "eventday",
                "Type": "string",
              },
            ],
            "Compressed": false,
            "InputFormat": "org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat",
            "Location": {
              "Fn::Join": [
                "",
                [
                  "s3://",
                  {
                    "Ref": "AthenaWorkGroupAthenaWorkgroupBucket281C578F",
                  },
                  "/appfabric/",
                ],
              ],
            },
            "OutputFormat": "org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat",
            "SerdeInfo": {
              "SerializationLibrary": "org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe",
            },
            "StoredAsSubDirectories": true,
          },
          "TableType": "EXTERNAL_TABLE",
        },
      },
      "Type": "AWS::Glue::Table",
    },
    "GlueTablecloudtrailGluePermissioncloudtrailquickSightAdminB0DE1F9F": {
      "Properties": {
        "Permissions": [
          "SELECT",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Ref": "QuickSightUserNameArn",
          },
        },
        "Resource": {
          "Table": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "DatabaseName": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "Name": {
              "Ref": "GlueTablecloudtrailGlueTableDFE8684D",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTablecloudtrailGluePermissioncloudtrailquickSightServiceLinkedRole298BF092": {
      "Properties": {
        "Permissions": [
          "SELECT",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::",
                {
                  "Ref": "AWS::AccountId",
                },
                ":role/service-role/",
                {
                  "Fn::FindInMap": [
                    "Solution",
                    "QuickSightConfiguration",
                    "QuickSightServiceLinkedRoleName",
                  ],
                },
              ],
            ],
          },
        },
        "Resource": {
          "Table": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "DatabaseName": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "Name": {
              "Ref": "GlueTablecloudtrailGlueTableDFE8684D",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTablecloudtrailGlueTableDFE8684D": {
      "Properties": {
        "CatalogId": {
          "Ref": "AWS::AccountId",
        },
        "DatabaseName": {
          "Ref": "GlueDatabaseGlueDB33F3ED0A",
        },
        "TableInput": {
          "Description": "Glue placeholder table for cloudtrail",
          "Name": "cloudtrail",
          "Parameters": {
            "classification": "parquet",
            "has_encrypted_data": true,
          },
          "StorageDescriptor": {
            "Columns": [
              {
                "Name": "metadata",
                "Type": "struct<product:struct<version:string,name:string,vendor_name:string,feature:struct<name:string>>,uid:string,event_code:string,profiles:array<string>,version:string>",
              },
              {
                "Name": "time",
                "Type": "bigint",
              },
              {
                "Name": "cloud",
                "Type": "struct<region:string,provider:string>",
              },
              {
                "Name": "api",
                "Type": "struct<response:struct<error:string,message:string>,operation:string,version:string,service:struct<name:string>,request:struct<uid:string>>",
              },
              {
                "Name": "dst_endpoint",
                "Type": "struct<svc_name:string>",
              },
              {
                "Name": "actor",
                "Type": "struct<user:struct<type:string,name:string,uid:string,uuid:string,account:struct<uid:string>,credential_uid:string>,session:struct<created_time:bigint,is_mfa:boolean,issuer:string>,invoked_by:string,idp:struct<name:string>>",
              },
              {
                "Name": "http_request",
                "Type": "struct<user_agent:string>",
              },
              {
                "Name": "src_endpoint",
                "Type": "struct<uid:string,ip:string,domain:string>",
              },
              {
                "Name": "resources",
                "Type": "array<struct<uid:string,account_id:string,type:string>>",
              },
              {
                "Name": "class_name",
                "Type": "string",
              },
              {
                "Name": "class_uid",
                "Type": "int",
              },
              {
                "Name": "category_name",
                "Type": "string",
              },
              {
                "Name": "category_uid",
                "Type": "int",
              },
              {
                "Name": "severity_id",
                "Type": "int",
              },
              {
                "Name": "severity",
                "Type": "string",
              },
              {
                "Name": "user",
                "Type": "struct<uid:string,uuid:string,name:string>",
              },
              {
                "Name": "activity_name",
                "Type": "string",
              },
              {
                "Name": "activity_id",
                "Type": "int",
              },
              {
                "Name": "type_uid",
                "Type": "int",
              },
              {
                "Name": "type_name",
                "Type": "string",
              },
              {
                "Name": "status",
                "Type": "string",
              },
              {
                "Name": "status_id",
                "Type": "int",
              },
              {
                "Name": "is_mfa",
                "Type": "boolean",
              },
              {
                "Name": "unmapped",
                "Type": "map<string,string>",
              },
              {
                "Name": "region",
                "Type": "string",
              },
              {
                "Name": "accountid",
                "Type": "string",
              },
              {
                "Name": "time_dt",
                "Type": "timestamp",
              },
              {
                "Name": "observables",
                "Type": "array<struct<name:string,value:string,type:string,type_id:int>>",
              },
            ],
            "Compressed": false,
            "InputFormat": "org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat",
            "Location": {
              "Fn::Join": [
                "",
                [
                  "s3://",
                  {
                    "Ref": "AthenaWorkGroupAthenaWorkgroupBucket281C578F",
                  },
                  "/cloudtrail/",
                ],
              ],
            },
            "OutputFormat": "org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat",
            "SerdeInfo": {
              "SerializationLibrary": "org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe",
            },
            "StoredAsSubDirectories": true,
          },
          "TableType": "EXTERNAL_TABLE",
        },
      },
      "Type": "AWS::Glue::Table",
    },
    "GlueTableshGluePermissionshquickSightAdmin2AEDB310": {
      "Properties": {
        "Permissions": [
          "SELECT",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Ref": "QuickSightUserNameArn",
          },
        },
        "Resource": {
          "Table": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "DatabaseName": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "Name": {
              "Ref": "GlueTableshGlueTable9A7DE915",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTableshGluePermissionshquickSightServiceLinkedRoleA4A31A04": {
      "Properties": {
        "Permissions": [
          "SELECT",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::",
                {
                  "Ref": "AWS::AccountId",
                },
                ":role/service-role/",
                {
                  "Fn::FindInMap": [
                    "Solution",
                    "QuickSightConfiguration",
                    "QuickSightServiceLinkedRoleName",
                  ],
                },
              ],
            ],
          },
        },
        "Resource": {
          "Table": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "DatabaseName": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "Name": {
              "Ref": "GlueTableshGlueTable9A7DE915",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTableshGlueTable9A7DE915": {
      "Properties": {
        "CatalogId": {
          "Ref": "AWS::AccountId",
        },
        "DatabaseName": {
          "Ref": "GlueDatabaseGlueDB33F3ED0A",
        },
        "TableInput": {
          "Description": "Glue placeholder table for sh",
          "Name": "sh",
          "Parameters": {
            "classification": "parquet",
            "has_encrypted_data": true,
          },
          "StorageDescriptor": {
            "Columns": [
              {
                "Name": "metadata",
                "Type": "struct<product:struct<version:string,feature:struct<uid:string,name:string>,uid:string,vendor_name:string,name:string>,processed_time_dt:array<timestamp>,profiles:array<string>,version:string>",
              },
              {
                "Name": "time",
                "Type": "bigint",
              },
              {
                "Name": "confidence_score",
                "Type": "int",
              },
              {
                "Name": "cloud",
                "Type": "struct<account_uid:string,region:string,provider:string>",
              },
              {
                "Name": "resource",
                "Type": "struct<type:string,uid:string,cloud_partition:string,region:string,labels:array<string>,details:string,criticality:string>",
              },
              {
                "Name": "resources",
                "Type": "array<struct<type:string,uid:string,cloud_partition:string,region:string,labels:array<string>,data:string,criticality:string>>",
              },
              {
                "Name": "finding_info",
                "Type": "struct<created_time_dt:timestamp,uid:string,desc:string,title:string,modified_time_dt:timestamp,first_seen_time_dt:timestamp,last_seen_time_dt:timestamp,related_events:array<struct<product_uid:string,uid:string>>,types:array<string>,remediation:struct<desc:string,kb_articles:array<string>>,src_url:string>",
              },
              {
                "Name": "compliance",
                "Type": "struct<standards:array<string>,control:string,status:string,status_code:string>",
              },
              {
                "Name": "malware",
                "Type": "array<struct<name:string,path:string,classification_ids:array<int>,classifications:array<string>>>",
              },
              {
                "Name": "process",
                "Type": "struct<name:string,pid:int,file:struct<path:string,type_id:int,name:string>,parent_process:struct<pid:int>,created_time:bigint,terminated_time:bigint>",
              },
              {
                "Name": "vulnerabilities",
                "Type": "array<struct<cve:struct<cvss:struct<base_score:float,vector_string:string,version:string>,uid:string,created_time:bigint,modified_time:bigint>,references:array<string>,related_vulnerabilities:array<string>,vendor_name:string,kb_articles:array<string>,packages:array<struct<architecture:string,name:string,epoch:int,release:string,version:string>>>>",
              },
              {
                "Name": "class_name",
                "Type": "string",
              },
              {
                "Name": "class_uid",
                "Type": "int",
              },
              {
                "Name": "category_name",
                "Type": "string",
              },
              {
                "Name": "category_uid",
                "Type": "int",
              },
              {
                "Name": "severity_id",
                "Type": "int",
              },
              {
                "Name": "severity",
                "Type": "string",
              },
              {
                "Name": "activity_name",
                "Type": "string",
              },
              {
                "Name": "activity_id",
                "Type": "int",
              },
              {
                "Name": "type_uid",
                "Type": "int",
              },
              {
                "Name": "type_name",
                "Type": "string",
              },
              {
                "Name": "state_id",
                "Type": "int",
              },
              {
                "Name": "state",
                "Type": "string",
              },
              {
                "Name": "unmapped",
                "Type": "map<string,string>",
              },
              {
                "Name": "region",
                "Type": "string",
              },
              {
                "Name": "accountid",
                "Type": "string",
              },
              {
                "Name": "status",
                "Type": "string",
              },
              {
                "Name": "time_dt",
                "Type": "timestamp",
              },
              {
                "Name": "observables",
                "Type": "array<struct<name:string,value:string,type:string,type_id:int>>",
              },
            ],
            "Compressed": false,
            "InputFormat": "org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat",
            "Location": {
              "Fn::Join": [
                "",
                [
                  "s3://",
                  {
                    "Ref": "AthenaWorkGroupAthenaWorkgroupBucket281C578F",
                  },
                  "/sh/",
                ],
              ],
            },
            "OutputFormat": "org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat",
            "SerdeInfo": {
              "SerializationLibrary": "org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe",
            },
            "StoredAsSubDirectories": true,
          },
          "TableType": "EXTERNAL_TABLE",
        },
      },
      "Type": "AWS::Glue::Table",
    },
    "GlueTablevpcGluePermissionvpcquickSightAdmin58624F56": {
      "Properties": {
        "Permissions": [
          "SELECT",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Ref": "QuickSightUserNameArn",
          },
        },
        "Resource": {
          "Table": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "DatabaseName": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "Name": {
              "Ref": "GlueTablevpcGlueTable5D22903E",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTablevpcGluePermissionvpcquickSightServiceLinkedRole8FE21388": {
      "Properties": {
        "Permissions": [
          "SELECT",
        ],
        "PermissionsWithGrantOption": [],
        "Principal": {
          "DataLakePrincipalIdentifier": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::",
                {
                  "Ref": "AWS::AccountId",
                },
                ":role/service-role/",
                {
                  "Fn::FindInMap": [
                    "Solution",
                    "QuickSightConfiguration",
                    "QuickSightServiceLinkedRoleName",
                  ],
                },
              ],
            ],
          },
        },
        "Resource": {
          "Table": {
            "CatalogId": {
              "Ref": "AWS::AccountId",
            },
            "DatabaseName": {
              "Ref": "GlueDatabaseGlueDB33F3ED0A",
            },
            "Name": {
              "Ref": "GlueTablevpcGlueTable5D22903E",
            },
          },
        },
      },
      "Type": "AWS::LakeFormation::PrincipalPermissions",
    },
    "GlueTablevpcGlueTable5D22903E": {
      "Properties": {
        "CatalogId": {
          "Ref": "AWS::AccountId",
        },
        "DatabaseName": {
          "Ref": "GlueDatabaseGlueDB33F3ED0A",
        },
        "TableInput": {
          "Description": "Glue placeholder table for vpc",
          "Name": "vpc",
          "Parameters": {
            "classification": "parquet",
            "has_encrypted_data": true,
          },
          "StorageDescriptor": {
            "Columns": [
              {
                "Name": "metadata",
                "Type": "struct<product:struct<version:string,name:string,feature:struct<name:string>,vendor_name:string>,profiles:array<string>,version:string>",
              },
              {
                "Name": "cloud",
                "Type": "struct<account_uid:string,region:string,zone:string,provider:string>",
              },
              {
                "Name": "src_endpoint",
                "Type": "struct<port:bigint,svc_name:string,ip:string,intermediate_ips:array<string>,interface_uid:string,vpc_uid:string,instance_uid:string,subnet_uid:string>",
              },
              {
                "Name": "dst_endpoint",
                "Type": "struct<port:bigint,svc_name:string,ip:string,intermediate_ips:array<string>,interface_uid:string,vpc_uid:string,instance_uid:string,subnet_uid:string>",
              },
              {
                "Name": "connection_info",
                "Type": "struct<protocol_num:int,tcp_flags:int,protocol_ver:string,boundary_id:int,boundary:string,direction_id:int,direction:string>",
              },
              {
                "Name": "traffic",
                "Type": "struct<packets:bigint,bytes:bigint>",
              },
              {
                "Name": "time",
                "Type": "bigint",
              },
              {
                "Name": "start_time",
                "Type": "bigint",
              },
              {
                "Name": "end_time",
                "Type": "bigint",
              },
              {
                "Name": "status_code",
                "Type": "string",
              },
              {
                "Name": "severity_id",
                "Type": "int",
              },
              {
                "Name": "severity",
                "Type": "string",
              },
              {
                "Name": "class_name",
                "Type": "string",
              },
              {
                "Name": "class_uid",
                "Type": "int",
              },
              {
                "Name": "category_name",
                "Type": "string",
              },
              {
                "Name": "category_uid",
                "Type": "int",
              },
              {
                "Name": "activity_name",
                "Type": "string",
              },
              {
                "Name": "activity_id",
                "Type": "int",
              },
              {
                "Name": "disposition",
                "Type": "string",
              },
              {
                "Name": "disposition_id",
                "Type": "int",
              },
              {
                "Name": "type_uid",
                "Type": "int",
              },
              {
                "Name": "type_name",
                "Type": "string",
              },
              {
                "Name": "unmapped",
                "Type": "map<string,string>",
              },
              {
                "Name": "region",
                "Type": "string",
              },
              {
                "Name": "accountid",
                "Type": "string",
              },
              {
                "Name": "time_dt",
                "Type": "timestamp",
              },
            ],
            "Compressed": false,
            "InputFormat": "org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat",
            "Location": {
              "Fn::Join": [
                "",
                [
                  "s3://",
                  {
                    "Ref": "AthenaWorkGroupAthenaWorkgroupBucket281C578F",
                  },
                  "/vpc/",
                ],
              ],
            },
            "OutputFormat": "org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat",
            "SerdeInfo": {
              "SerializationLibrary": "org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe",
            },
            "StoredAsSubDirectories": true,
          },
          "TableType": "EXTERNAL_TABLE",
        },
      },
      "Type": "AWS::Glue::Table",
    },
    "MyKMSKey652619A7": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "EnableKeyRotation": true,
        "KeyPolicy": {
          "Statement": [
            {
              "Action": "kms:*",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "cloudwatch.amazonaws.com",
                  "events.amazonaws.com",
                  "ssm.amazonaws.com",
                ],
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::KMS::Key",
      "UpdateReplacePolicy": "Retain",
    },
    "MyKMSKeyAlias5E2DD126": {
      "Properties": {
        "AliasName": "alias/securityInsights/snsKey",
        "TargetKeyId": {
          "Fn::GetAtt": [
            "MyKMSKey652619A7",
            "Arn",
          ],
        },
      },
      "Type": "AWS::KMS::Alias",
    },
    "OpsItemStatusChangeRule80C40C7E": {
      "Properties": {
        "Description": "Triggers the sendMetrics Lambda function when the Solution Release Ops Item status changes",
        "EventPattern": {
          "detail": {
            "source": [
              "GitHub/AWS-Solutions",
            ],
            "status": [
              "Open",
              "Resolved",
            ],
          },
          "detail-type": [
            "OpsItem Update",
            "OpsItem Create",
          ],
          "source": [
            "aws.ssm",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "SendMetricsC28781AA",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "OpsItemStatusChangeRuleAllowEventRuleSecurityInsightsStackSendMetrics4112645A3C519ED0": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "SendMetricsC28781AA",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "OpsItemStatusChangeRule80C40C7E",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "QuickSightDataSetCreator": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "AthenaWorkGroupAD7AE63A",
        "CreateLakeFormationPermissionsCustomResource",
        "CreateQuickDataSetLogGroup0C2D914E",
        "CreateQuickSightDataSetsRoleCreatePolicy2EF85EB5",
        "CreateQuickSightDataSetsRoleUpdatePolicyE2C9043E",
      ],
      "Properties": {
        "AccountId": {
          "Ref": "AWS::AccountId",
        },
        "Region": {
          "Ref": "AWS::Region",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "CreateQuickDataSets875AE2C0",
            "Arn",
          ],
        },
        "Version": {
          "Fn::FindInMap": [
            "Solution",
            "SolutionConfiguration",
            "Version",
          ],
        },
      },
      "Type": "Custom::CreateQuickSightDataSets",
      "UpdateReplacePolicy": "Delete",
    },
    "QuickSightUserGroupManagerFCB2E9E2": {
      "Condition": "CreateQuickSightUserGroupsCondition",
      "DependsOn": [
        "QuickSightUserGroupManagerRoleF59C387E",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/quickSightUserGroupManager.zip",
        },
        "Description": "Creates default user groups and assigns permissions to view the Security Insights Dashboard and Analyses",
        "Environment": {
          "Variables": {
            "ACCOUNT_ID": {
              "Ref": "AWS::AccountId",
            },
            "DELAY_IN_SECONDS_FOR_RATE_LIMITING": "1",
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
            "QUICKSIGHT_ADMIN_REGION": {
              "Fn::Select": [
                3,
                {
                  "Fn::Split": [
                    ":",
                    {
                      "Ref": "QuickSightUserNameArn",
                    },
                  ],
                },
              ],
            },
            "QUICKSIGHT_ADMIN_USER_GROUP_NAME": {
              "Fn::Join": [
                "-",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "QuickSightConfiguration",
                      "AdminUserGroupName",
                    ],
                  },
                  {
                    "Ref": "AWS::Region",
                  },
                ],
              ],
            },
            "QUICKSIGHT_ENDPOINT_REGION": {
              "Ref": "AWS::Region",
            },
            "QUICKSIGHT_PRINCIPAL_ARN": {
              "Ref": "QuickSightUserNameArn",
            },
            "QUICKSIGHT_READ_USER_GROUP_NAME": {
              "Fn::Join": [
                "-",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "QuickSightConfiguration",
                      "ReadUserGroupName",
                    ],
                  },
                  {
                    "Ref": "AWS::Region",
                  },
                ],
              ],
            },
            "REGION": {
              "Ref": "AWS::Region",
            },
            "SOLUTION_ID": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "ID",
              ],
            },
            "SOLUTION_VERSION": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "Version",
              ],
            },
            "USER_AGENT_STRING": {
              "Fn::Sub": [
                "AWSSOLUTION/\${SolutionID}/\${Version}",
                {
                  "SolutionID": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "ID",
                    ],
                  },
                  "Version": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "Version",
                    ],
                  },
                },
              ],
            },
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "ReservedConcurrentExecutions": 1,
        "Role": {
          "Fn::GetAtt": [
            "QuickSightUserGroupManagerRoleF59C387E",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 300,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "QuickSightUserGroupManagerLogGroupB32D2998": {
      "Condition": "CreateQuickSightUserGroupsCondition",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "QuickSightUserGroupManagerFCB2E9E2",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "QuickSightUserGroupManagerRoleF59C387E": {
      "Condition": "CreateQuickSightUserGroupsCondition",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "QuickSightUserGroupManagerRolePolicy518705D5": {
      "Condition": "CreateQuickSightUserGroupsCondition",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "quicksight:CreateGroup",
                "quicksight:DeleteGroup",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:aws:quicksight:*:",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":group/default/",
                      {
                        "Fn::Join": [
                          "-",
                          [
                            {
                              "Fn::FindInMap": [
                                "Solution",
                                "QuickSightConfiguration",
                                "AdminUserGroupName",
                              ],
                            },
                            {
                              "Ref": "AWS::Region",
                            },
                          ],
                        ],
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:aws:quicksight:*:",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":group/default/",
                      {
                        "Fn::Join": [
                          "-",
                          [
                            {
                              "Fn::FindInMap": [
                                "Solution",
                                "QuickSightConfiguration",
                                "ReadUserGroupName",
                              ],
                            },
                            {
                              "Ref": "AWS::Region",
                            },
                          ],
                        ],
                      },
                    ],
                  ],
                },
              ],
              "Sid": "AllowCreateQuickSightUserGroup",
            },
            {
              "Action": "quicksight:UpdateDashboardPermissions",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":quicksight:*:",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":dashboard/",
                    {
                      "Fn::Join": [
                        "-",
                        [
                          {
                            "Fn::FindInMap": [
                              "Solution",
                              "QuickSightConfiguration",
                              "QuickSightDashboardName",
                            ],
                          },
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      ],
                    },
                  ],
                ],
              },
              "Sid": "AllowUpdateQuickSightDashboardPermissions",
            },
            {
              "Action": "quicksight:UpdateAnalysisPermissions",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":quicksight:*:",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":analysis/",
                    {
                      "Fn::Join": [
                        "-",
                        [
                          {
                            "Fn::FindInMap": [
                              "Solution",
                              "QuickSightConfiguration",
                              "QuickSightAnalysisName",
                            ],
                          },
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      ],
                    },
                  ],
                ],
              },
              "Sid": "AllowUpdateQuickSightAnalysisPermissions",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "XrayPolicy",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
              "Sid": "LamdaLogGroupPolicyStatement",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "QuickSightUserGroupManagerRolePolicy518705D5",
        "Roles": [
          {
            "Ref": "QuickSightUserGroupManagerRoleF59C387E",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "QuickSightUserGroups": {
      "Condition": "CreateQuickSightUserGroupsCondition",
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "QuickSightUserGroupManagerLogGroupB32D2998",
        "QuickSightUserGroupManagerRolePolicy518705D5",
        "SecurityInsightsDashboard",
      ],
      "Properties": {
        "AnalysisID": {
          "Fn::Join": [
            "-",
            [
              {
                "Fn::FindInMap": [
                  "Solution",
                  "QuickSightConfiguration",
                  "QuickSightAnalysisId",
                ],
              },
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
        "DashboardID": {
          "Fn::Join": [
            "-",
            [
              {
                "Fn::FindInMap": [
                  "Solution",
                  "QuickSightConfiguration",
                  "QuickSightDashboardId",
                ],
              },
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
        "Region": {
          "Ref": "AWS::Region",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "QuickSightUserGroupManagerFCB2E9E2",
            "Arn",
          ],
        },
      },
      "Type": "Custom::QuickSightUserGroups",
      "UpdateReplacePolicy": "Delete",
    },
    "ReleaseNotificationSchedule206F401D": {
      "Condition": "CreateSolutionReleaseNotificationCondition",
      "Properties": {
        "FlexibleTimeWindow": {
          "MaximumWindowInMinutes": 600,
          "Mode": "FLEXIBLE",
        },
        "ScheduleExpression": "rate(3 days)",
        "ScheduleExpressionTimezone": "Etc/UTC",
        "State": "ENABLED",
        "Target": {
          "Arn": {
            "Fn::GetAtt": [
              "CreateSolutionReleaseNotificationFunction93A179B7",
              "Arn",
            ],
          },
          "RetryPolicy": {
            "MaximumEventAgeInSeconds": 86400,
            "MaximumRetryAttempts": 185,
          },
          "RoleArn": {
            "Fn::GetAtt": [
              "CreateReleaseNotificationSchedulerRoleEA21E02B",
              "Arn",
            ],
          },
        },
      },
      "Type": "AWS::Scheduler::Schedule",
    },
    "SSMParameterMetricsRuleEventsRule419EF5EC": {
      "Properties": {
        "EventPattern": {
          "detail-type": [
            "Parameter Store Change",
          ],
          "resources": [
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "SsmParametervpcFlowLogsBF597E17",
                  },
                ],
              ],
            },
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "SsmParametercloudtrail552F6505",
                  },
                ],
              ],
            },
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "SsmParametersecurityHub8017A884",
                  },
                ],
              ],
            },
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "SsmParameterappfabricA8D61F4D",
                  },
                ],
              ],
            },
          ],
          "source": [
            "aws.ssm",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "SendMetricsC28781AA",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "SecurityHubTopic": {
      "Condition": "CreateQuickSightQTopicsCondition",
      "DependsOn": [
        "createQuickSightDataSetRefreshSchedulesCustomResource",
      ],
      "Properties": {
        "AwsAccountId": {
          "Ref": "AWS::AccountId",
        },
        "DataSets": [
          {
            "Columns": [
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "UID",
                "ColumnName": "UID",
                "ColumnSynonyms": [
                  "Event",
                  "document",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Identifier",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Product",
                "ColumnName": "Product_Name",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Vendor",
                "ColumnName": "Product_Vendor_Name",
                "ColumnSynonyms": [
                  "manufacturer name",
                  "product seller name",
                  "supplier name",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Organization",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Processed Timestamp",
                "ColumnName": "Processed_Timestamp",
                "ColumnSynonyms": [
                  "processed time",
                  "processed date",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Date",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Timestamp",
                "ColumnName": "Timestamp",
                "ColumnSynonyms": [
                  "date",
                  "time period",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Date",
                },
              },
              {
                "ColumnDataRole": "MEASURE",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Confidence Score",
                "ColumnName": "Confidence_Score",
                "ColumnSynonyms": [
                  "confidence rating",
                  "trust score",
                  "confidence level",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Cloud Provider",
                "ColumnName": "Cloud_Provider",
                "ColumnSynonyms": [
                  "cloud supplier",
                  "cloud vendor",
                  "cloud company",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Organization",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Created Timestamp",
                "ColumnName": "Created_Timestamp",
                "ColumnSynonyms": [
                  "creation timestamp",
                  "created time",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Date",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Title",
                "ColumnName": "Title",
                "ColumnSynonyms": [
                  "name",
                  "description",
                  "document",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "First Seen Timestamp",
                "ColumnName": "First_Seen_Timestamp",
                "ColumnSynonyms": [
                  "first viewed time",
                  "first seen time",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Date",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Last Seen Timestamp",
                "ColumnName": "Last_Seen_Timestamp",
                "ColumnSynonyms": [
                  "last seen times",
                  "last visited time",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Date",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Compliance Control",
                "ColumnName": "Compliance_Control",
                "ColumnSynonyms": [
                  "compliance check",
                  "compliance management",
                  "compliance audit",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Compliance",
                "ColumnName": "Compliance_Status",
                "ColumnSynonyms": [
                  "compliance level",
                  "regulatory status",
                  "certification status",
                  "compliance status",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Compliance Status Code",
                "ColumnName": "Compliance_Status_Code",
                "ColumnSynonyms": [
                  "conformity status",
                  "conformity status code",
                  "audit status",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Class",
                "ColumnName": "Class",
                "ColumnSynonyms": [
                  "subclass",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Category",
                "ColumnName": "Category",
                "ColumnSynonyms": [
                  "classification",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Activity",
                "ColumnName": "Activity",
                "ColumnSynonyms": [
                  "action",
                  "occurrence",
                  "task",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Type",
                "ColumnName": "Type",
                "ColumnSynonyms": [
                  "form",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Severity",
                "ColumnName": "Severity",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Status",
                "ColumnName": "Status",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Account Id",
                "ColumnName": "Account_Id",
                "ColumnSynonyms": [
                  "customer id",
                  "customer account",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Identifier",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Region",
                "ColumnName": "Region",
                "ColumnSynonyms": [
                  "area",
                  "geographical area",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "SubTypeName": "Level200",
                  "TypeName": "Location",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Host Name",
                "ColumnName": "Host_Name",
                "ColumnSynonyms": [
                  "server name",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Ip Address",
                "ColumnName": "Ip_Address",
                "ColumnSynonyms": [
                  "IP adress",
                  "IP",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "User Name",
                "ColumnName": "User_Name",
                "ColumnSynonyms": [
                  "customer name",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Email Address",
                "ColumnName": "Email_Address",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "End Point",
                "ColumnName": "End_Point",
                "ColumnSynonyms": [
                  "termination point",
                  "end destination",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Geo Location",
                "ColumnName": "Geo_Location",
                "ColumnSynonyms": [
                  "locale",
                  "geography",
                  "geographic location",
                ],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Workflow",
                "ColumnName": "Workflow_State",
                "ColumnSynonyms": [
                  "process state",
                  "working state",
                  "workflow status",
                  "workflow state",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Record",
                "ColumnName": "Record_State",
                "ColumnSynonyms": [
                  "document state",
                  "record status",
                  "record state",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Finding Id",
                "ColumnName": "Finding_Id",
                "ColumnSynonyms": [
                  "discovery id",
                  "found",
                  "determination id",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
                "SemanticType": {
                  "TypeName": "Identifier",
                },
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Resource Type",
                "ColumnName": "Resource_Type",
                "ColumnSynonyms": [],
                "IsIncludedInTopic": false,
                "NeverAggregateInFilter": false,
              },
              {
                "ColumnDataRole": "DIMENSION",
                "ColumnDescription": "",
                "ColumnFriendlyName": "Compliance Standard",
                "ColumnName": "Compliance_Standard",
                "ColumnSynonyms": [
                  "conformity standard",
                  "conformity",
                  "requirements",
                ],
                "IsIncludedInTopic": true,
                "NeverAggregateInFilter": false,
              },
            ],
            "DatasetArn": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":quicksight:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":dataset/Security_Insights_Security_Hub_Dataset",
                ],
              ],
            },
            "DatasetName": "Security_Insights_Security_Hub_Dataset",
            "NamedEntities": [
              {
                "Definition": [
                  {
                    "FieldName": "Finding_Id",
                  },
                  {
                    "FieldName": "Workflow_State",
                  },
                  {
                    "FieldName": "Status",
                  },
                  {
                    "FieldName": "Record_State",
                  },
                  {
                    "FieldName": "Compliance_Status",
                  },
                  {
                    "FieldName": "Resource_Type",
                  },
                  {
                    "FieldName": "First_Seen_Timestamp",
                  },
                  {
                    "FieldName": "Last_Seen_Timestamp",
                  },
                  {
                    "FieldName": "Title",
                  },
                  {
                    "FieldName": "Type",
                  },
                  {
                    "FieldName": "Account_Id",
                  },
                  {
                    "FieldName": "Activity",
                  },
                  {
                    "FieldName": "Category",
                  },
                  {
                    "FieldName": "Class",
                  },
                  {
                    "FieldName": "Compliance_Control",
                  },
                  {
                    "FieldName": "Compliance_Standard",
                  },
                  {
                    "FieldName": "Compliance_Status_Code",
                  },
                  {
                    "FieldName": "Confidence_Score",
                  },
                  {
                    "FieldName": "Created_Timestamp",
                  },
                  {
                    "FieldName": "Product_Name",
                  },
                  {
                    "FieldName": "Severity",
                  },
                  {
                    "FieldName": "User_Name",
                  },
                  {
                    "FieldName": "Product_Vendor_Name",
                  },
                  {
                    "FieldName": "Timestamp",
                  },
                  {
                    "FieldName": "Region",
                  },
                  {
                    "FieldName": "Ip_Address",
                  },
                  {
                    "FieldName": "Host_Name",
                  },
                  {
                    "FieldName": "Geo_Location",
                  },
                  {
                    "FieldName": "End_Point",
                  },
                  {
                    "FieldName": "Processed_Timestamp",
                  },
                  {
                    "FieldName": "Email_Address",
                  },
                  {
                    "FieldName": "Cloud_Provider",
                  },
                  {
                    "FieldName": "UID",
                  },
                ],
                "EntityDescription": "Security Hub Findings Records",
                "EntityName": "Security Hub Findings Records",
                "EntitySynonyms": [],
              },
            ],
          },
        ],
        "Description": "This is a topic for Security Hub data source",
        "Name": "SecurityInsights-SecurityHubTopic",
        "TopicId": "SecurityInsights-SecurityHubTopic",
        "UserExperienceVersion": "NEW_READER_EXPERIENCE",
      },
      "Type": "AWS::QuickSight::Topic",
    },
    "SecurityInsightsAnalysis": {
      "DependsOn": [
        "QuickSightDataSetCreator",
      ],
      "Properties": {
        "AnalysisId": {
          "Fn::Join": [
            "-",
            [
              {
                "Fn::FindInMap": [
                  "Solution",
                  "QuickSightConfiguration",
                  "QuickSightAnalysisId",
                ],
              },
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
        "AwsAccountId": {
          "Ref": "AWS::AccountId",
        },
        "Name": {
          "Fn::Join": [
            "-",
            [
              {
                "Fn::FindInMap": [
                  "Solution",
                  "QuickSightConfiguration",
                  "QuickSightAnalysisName",
                ],
              },
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
        "Permissions": [
          {
            "Actions": [
              "quicksight:RestoreAnalysis",
              "quicksight:UpdateAnalysisPermissions",
              "quicksight:DeleteAnalysis",
              "quicksight:DescribeAnalysisPermissions",
              "quicksight:QueryAnalysis",
              "quicksight:DescribeAnalysis",
              "quicksight:UpdateAnalysis",
            ],
            "Principal": {
              "Ref": "QuickSightUserNameArn",
            },
          },
        ],
        "SourceEntity": {
          "SourceTemplate": {
            "Arn": "arn:aws:quicksight:us-east-1:11111:template/solutions-features_Security-insights-on-aws_appFabricInsights",
            "DataSetReferences": [
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Suspicious_Logins",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_AppFabric_Suspicious_Logins",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_IP_Address_Logins",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_AppFabric_IP_Address_Logins",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Apps_Failed_Logins",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_AppFabric_Apps_Failed_Logins",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Logins_By_Applications",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_AppFabric_Logins_By_Applications",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Security_Hub_Dataset",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_Security_Hub_Dataset",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Cloudtrail_Dataset",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_Cloudtrail_Dataset",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_VPC_Flow_Dataset",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_VPC_Flow_Dataset",
              },
            ],
          },
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::QuickSight::Analysis",
    },
    "SecurityInsightsDashboard": {
      "DependsOn": [
        "SecurityInsightsAnalysis",
      ],
      "Properties": {
        "AwsAccountId": {
          "Ref": "AWS::AccountId",
        },
        "DashboardId": {
          "Fn::Join": [
            "-",
            [
              {
                "Fn::FindInMap": [
                  "Solution",
                  "QuickSightConfiguration",
                  "QuickSightDashboardId",
                ],
              },
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
        "DashboardPublishOptions": {
          "AdHocFilteringOption": {
            "AvailabilityStatus": "DISABLED",
          },
          "DataPointDrillUpDownOption": {
            "AvailabilityStatus": "ENABLED",
          },
          "DataPointMenuLabelOption": {
            "AvailabilityStatus": "ENABLED",
          },
          "DataPointTooltipOption": {
            "AvailabilityStatus": "ENABLED",
          },
          "ExportToCSVOption": {
            "AvailabilityStatus": "ENABLED",
          },
          "ExportWithHiddenFieldsOption": {
            "AvailabilityStatus": "DISABLED",
          },
          "SheetControlsOption": {
            "VisibilityState": "COLLAPSED",
          },
          "SheetLayoutElementMaximizationOption": {
            "AvailabilityStatus": "ENABLED",
          },
          "VisualAxisSortOption": {
            "AvailabilityStatus": "ENABLED",
          },
          "VisualMenuOption": {
            "AvailabilityStatus": "ENABLED",
          },
        },
        "Name": {
          "Fn::Join": [
            "-",
            [
              {
                "Fn::FindInMap": [
                  "Solution",
                  "QuickSightConfiguration",
                  "QuickSightDashboardId",
                ],
              },
              {
                "Ref": "AWS::Region",
              },
            ],
          ],
        },
        "Permissions": [
          {
            "Actions": [
              "quicksight:DescribeDashboard",
              "quicksight:ListDashboardVersions",
              "quicksight:UpdateDashboardPermissions",
              "quicksight:QueryDashboard",
              "quicksight:UpdateDashboard",
              "quicksight:DeleteDashboard",
              "quicksight:DescribeDashboardPermissions",
              "quicksight:UpdateDashboardPublishedVersion",
            ],
            "Principal": {
              "Ref": "QuickSightUserNameArn",
            },
          },
        ],
        "SourceEntity": {
          "SourceTemplate": {
            "Arn": "arn:aws:quicksight:us-east-1:11111:template/solutions-features_Security-insights-on-aws_appFabricInsights",
            "DataSetReferences": [
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Suspicious_Logins",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_AppFabric_Suspicious_Logins",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_IP_Address_Logins",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_AppFabric_IP_Address_Logins",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Apps_Failed_Logins",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_AppFabric_Apps_Failed_Logins",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_AppFabric_Logins_By_Applications",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_AppFabric_Logins_By_Applications",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Security_Hub_Dataset",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_Security_Hub_Dataset",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_Cloudtrail_Dataset",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_Cloudtrail_Dataset",
              },
              {
                "DataSetArn": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":quicksight:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":dataset/Security_Insights_VPC_Flow_Dataset",
                    ],
                  ],
                },
                "DataSetPlaceholder": "Security_Insights_VPC_Flow_Dataset",
              },
            ],
          },
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::QuickSight::Dashboard",
    },
    "SendMetricsAwsEventsLambdaInvokePermission1249C78FB": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "SendMetricsC28781AA",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "SSMParameterMetricsRuleEventsRule419EF5EC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "SendMetricsC28781AA": {
      "DependsOn": [
        "SendMetricsRole4F2200AA",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/sendMetrics.zip",
        },
        "Description": "Lambda function to send athena metrics",
        "Environment": {
          "Variables": {
            "ATHENA_WORKGROUP": {
              "Fn::Join": [
                "-",
                [
                  {
                    "Fn::FindInMap": [
                      "Solution",
                      "AthenaConfiguration",
                      "AthenaWorkgroupName",
                    ],
                  },
                  {
                    "Ref": "AWS::Region",
                  },
                ],
              ],
            },
            "INPUT_PARAMETER_CREATE_QUICKSIGHT_Q_TOPICS": {
              "Ref": "CreateQuickSightQTopics",
            },
            "INPUT_PARAMETER_CREATE_QUICKSIGHT_USER_GROUPS": {
              "Ref": "CreateQuickSightUserGroups",
            },
            "INPUT_PARAMETER_CREATE_SOLUTION_RELEASE_NOTIFICATION": {
              "Ref": "CreateNewSolutionReleaseNotification",
            },
            "INPUT_PARAMETER_FREQUENCY": {
              "Ref": "Frequency",
            },
            "INPUT_PARAMETER_LOG_LEVEL": {
              "Ref": "LogLevel",
            },
            "INPUT_PARAMETER_MONTHLY_REFRESH_DAY": {
              "Ref": "MonthlyRefreshDay",
            },
            "INPUT_PARAMETER_THRESHOLD_UNIT_FOR_ATHENA_ALARM": {
              "Ref": "ThresholdUnitForAthenaAlarm",
            },
            "INPUT_PARAMETER_THRESHOLD_VALUE_FOR_ATHENA_ALARM": {
              "Ref": "ThresholdValueForAthenaAlarm",
            },
            "INPUT_PARAMETER_WEEKLY_REFRESH_DAY": {
              "Ref": "WeeklyRefreshDay",
            },
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
            "METRICS_ENDPOINT": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "MetricsURL",
              ],
            },
            "SEND_METRIC": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "SendAnonymizedUsageData",
              ],
            },
            "SOLUTION_ID": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "ID",
              ],
            },
            "SOLUTION_VERSION": {
              "Fn::FindInMap": [
                "Solution",
                "SolutionConfiguration",
                "Version",
              ],
            },
            "USER_AGENT_STRING": {
              "Fn::Sub": [
                "AWSSOLUTION/\${SolutionID}/\${Version}",
                {
                  "SolutionID": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "ID",
                    ],
                  },
                  "Version": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "Version",
                    ],
                  },
                },
              ],
            },
            "UUID": {
              "Fn::GetAtt": [
                "UUIDGenerator",
                "UUID",
              ],
            },
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "ReservedConcurrentExecutions": 5,
        "Role": {
          "Fn::GetAtt": [
            "SendMetricsRole4F2200AA",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 90,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "SendMetricsCustomResource": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "SendMetricsLogGroupCFAD87AD",
        "SendMetricsRolePolicy2F577BF6",
      ],
      "Properties": {
        "AccountId": {
          "Ref": "AWS::AccountId",
        },
        "INPUT_PARAMETER_CREATE_QUICKSIGHT_Q_TOPICS": {
          "Ref": "CreateQuickSightQTopics",
        },
        "INPUT_PARAMETER_CREATE_QUICKSIGHT_USER_GROUPS": {
          "Ref": "CreateQuickSightUserGroups",
        },
        "INPUT_PARAMETER_CREATE_SOLUTION_RELEASE_NOTIFICATION": {
          "Ref": "CreateNewSolutionReleaseNotification",
        },
        "INPUT_PARAMETER_FREQUENCY": {
          "Ref": "Frequency",
        },
        "INPUT_PARAMETER_LOG_LEVEL": {
          "Ref": "LogLevel",
        },
        "INPUT_PARAMETER_MONTHLY_REFRESH_DAY": {
          "Ref": "MonthlyRefreshDay",
        },
        "INPUT_PARAMETER_THRESHOLD_UNIT_FOR_ATHENA_ALARM": {
          "Ref": "ThresholdUnitForAthenaAlarm",
        },
        "INPUT_PARAMETER_THRESHOLD_VALUE_FOR_ATHENA_ALARM": {
          "Ref": "ThresholdValueForAthenaAlarm",
        },
        "INPUT_PARAMETER_WEEKLY_REFRESH_DAY": {
          "Ref": "WeeklyRefreshDay",
        },
        "Region": {
          "Ref": "AWS::Region",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "SendMetricsC28781AA",
            "Arn",
          ],
        },
      },
      "Type": "Custom::SendMetricsCustomResource",
      "UpdateReplacePolicy": "Delete",
    },
    "SendMetricsLogGroupCFAD87AD": {
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "SendMetricsC28781AA",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "SendMetricsRole4F2200AA": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "SendMetricsRolePolicy2F577BF6": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "athena:GetQueryExecution",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:athena:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":workgroup/",
                    {
                      "Fn::Join": [
                        "-",
                        [
                          {
                            "Fn::FindInMap": [
                              "Solution",
                              "AthenaConfiguration",
                              "AthenaWorkgroupName",
                            ],
                          },
                          {
                            "Ref": "AWS::Region",
                          },
                        ],
                      ],
                    },
                  ],
                ],
              },
              "Sid": "GetAthenaQueryExecutionMetrics",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:CreateGrant",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "MyKMSKey652619A7",
                  "Arn",
                ],
              },
            },
            {
              "Action": "kms:ListAliases",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
              "Sid": "LamdaLogGroupPolicyStatement",
            },
            {
              "Action": "ssm:GetParameter",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametervpcFlowLogsBF597E17",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametercloudtrail552F6505",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametersecurityHub8017A884",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParameterappfabricA8D61F4D",
                      },
                    ],
                  ],
                },
              ],
              "Sid": "SSMParameterPolicyStatement",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SendMetricsRolePolicy2F577BF6",
        "Roles": [
          {
            "Ref": "SendMetricsRole4F2200AA",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SetupLakeFormationPermissionsPolicy05021B38": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "lakeformation:DescribeResource",
                "lakeformation:ListResources",
                "lakeformation:GrantPermissions",
                "lakeformation:ListPermissions",
                "lakeformation:GetDataLakeSettings",
                "lakeformation:BatchGrantPermissions",
                "lakeformation:PutDataLakeSettings",
                "lakeformation:RevokePermissions",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "CreateLakeFormationPermissions",
            },
            {
              "Action": [
                "glue:CreateDatabase",
                "glue:CreateTable",
                "glue:GetTables",
                "glue:GetTable",
                "glue:GetDatabases",
                "glue:GetDatabase",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":catalog",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":database/",
                      {
                        "Fn::Join": [
                          "_",
                          [
                            {
                              "Fn::FindInMap": [
                                "Solution",
                                "SecurityLakeConfiguration",
                                "SecurityLakeDatabasePrefix",
                              ],
                            },
                            {
                              "Fn::Join": [
                                "_",
                                {
                                  "Fn::Split": [
                                    "-",
                                    {
                                      "Ref": "AWS::Region",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        ],
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":database/",
                      {
                        "Fn::FindInMap": [
                          "Solution",
                          "SecurityLakeConfiguration",
                          "ResourceLinkDatabase",
                        ],
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":table/",
                      {
                        "Fn::FindInMap": [
                          "Solution",
                          "SecurityLakeConfiguration",
                          "ResourceLinkDatabase",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":table/",
                      {
                        "Fn::Join": [
                          "_",
                          [
                            {
                              "Fn::FindInMap": [
                                "Solution",
                                "SecurityLakeConfiguration",
                                "SecurityLakeDatabasePrefix",
                              ],
                            },
                            {
                              "Fn::Join": [
                                "_",
                                {
                                  "Fn::Split": [
                                    "-",
                                    {
                                      "Ref": "AWS::Region",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":userDefinedFunction/",
                      {
                        "Fn::FindInMap": [
                          "Solution",
                          "SecurityLakeConfiguration",
                          "ResourceLinkDatabase",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":userDefinedFunction/",
                      {
                        "Fn::Join": [
                          "_",
                          [
                            {
                              "Fn::FindInMap": [
                                "Solution",
                                "SecurityLakeConfiguration",
                                "SecurityLakeDatabasePrefix",
                              ],
                            },
                            {
                              "Fn::Join": [
                                "_",
                                {
                                  "Fn::Split": [
                                    "-",
                                    {
                                      "Ref": "AWS::Region",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "SecurityLakeAccountId",
                      },
                      ":catalog",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "SecurityLakeAccountId",
                      },
                      ":database/",
                      {
                        "Fn::Join": [
                          "_",
                          [
                            {
                              "Fn::FindInMap": [
                                "Solution",
                                "SecurityLakeConfiguration",
                                "SecurityLakeDatabasePrefix",
                              ],
                            },
                            {
                              "Fn::Join": [
                                "_",
                                {
                                  "Fn::Split": [
                                    "-",
                                    {
                                      "Ref": "AWS::Region",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        ],
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "SecurityLakeAccountId",
                      },
                      ":table/",
                      {
                        "Fn::Join": [
                          "_",
                          [
                            {
                              "Fn::FindInMap": [
                                "Solution",
                                "SecurityLakeConfiguration",
                                "SecurityLakeDatabasePrefix",
                              ],
                            },
                            {
                              "Fn::Join": [
                                "_",
                                {
                                  "Fn::Split": [
                                    "-",
                                    {
                                      "Ref": "AWS::Region",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "SecurityLakeAccountId",
                      },
                      ":userDefinedFunction/",
                      {
                        "Fn::Join": [
                          "_",
                          [
                            {
                              "Fn::FindInMap": [
                                "Solution",
                                "SecurityLakeConfiguration",
                                "SecurityLakeDatabasePrefix",
                              ],
                            },
                            {
                              "Fn::Join": [
                                "_",
                                {
                                  "Fn::Split": [
                                    "-",
                                    {
                                      "Ref": "AWS::Region",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
              "Sid": "GlueResourcesPermissions",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SetupLakeFormationPermissionsPolicy05021B38",
        "Roles": [
          {
            "Ref": "SetupLakeFormationPermissionsRoleB563CC38",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SetupLakeFormationPermissionsRoleB563CC38": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "SsmParameterappfabricA8D61F4D": {
      "Properties": {
        "Description": "SSM parameter to toggle the data source appfabric in the Security Lake",
        "Name": {
          "Fn::Join": [
            "",
            [
              "/solutions/securityInsights/",
              {
                "Ref": "AWS::Region",
              },
              "/appfabric",
            ],
          ],
        },
        "Tags": {
          "awsApplication": {
            "Fn::GetAtt": [
              "AppRegistry",
              "ApplicationTagValue",
            ],
          },
        },
        "Type": "String",
        "Value": "{"status":"Disabled","queryWindowDuration":"7"}",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "SsmParametercloudtrail552F6505": {
      "Properties": {
        "Description": "SSM parameter to toggle the data source cloudtrail in the Security Lake",
        "Name": {
          "Fn::Join": [
            "",
            [
              "/solutions/securityInsights/",
              {
                "Ref": "AWS::Region",
              },
              "/cloudtrail",
            ],
          ],
        },
        "Tags": {
          "awsApplication": {
            "Fn::GetAtt": [
              "AppRegistry",
              "ApplicationTagValue",
            ],
          },
        },
        "Type": "String",
        "Value": "{"status":"Disabled","queryWindowDuration":"7"}",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "SsmParametersecurityHub8017A884": {
      "Properties": {
        "Description": "SSM parameter to toggle the data source securityHub in the Security Lake",
        "Name": {
          "Fn::Join": [
            "",
            [
              "/solutions/securityInsights/",
              {
                "Ref": "AWS::Region",
              },
              "/securityHub",
            ],
          ],
        },
        "Tags": {
          "awsApplication": {
            "Fn::GetAtt": [
              "AppRegistry",
              "ApplicationTagValue",
            ],
          },
        },
        "Type": "String",
        "Value": "{"status":"Disabled","queryWindowDuration":"7"}",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "SsmParametervpcFlowLogsBF597E17": {
      "Properties": {
        "Description": "SSM parameter to toggle the data source vpcFlowLogs in the Security Lake",
        "Name": {
          "Fn::Join": [
            "",
            [
              "/solutions/securityInsights/",
              {
                "Ref": "AWS::Region",
              },
              "/vpcFlowLogs",
            ],
          ],
        },
        "Tags": {
          "awsApplication": {
            "Fn::GetAtt": [
              "AppRegistry",
              "ApplicationTagValue",
            ],
          },
        },
        "Type": "String",
        "Value": "{"status":"Disabled","queryWindowDuration":"7"}",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "UUIDGenerator": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "UUIDGeneratorSendAthenaMetricsLogGroup6B352C7B",
        "UUIDGeneratorFunction",
      ],
      "Properties": {
        "Region": {
          "Ref": "AWS::Region",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "UUIDGeneratorFunction",
            "Arn",
          ],
        },
      },
      "Type": "Custom::UUIDGenerator",
      "UpdateReplacePolicy": "Delete",
    },
    "UUIDGeneratorFunction": {
      "DependsOn": [
        "UUIDGeneratorRole",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W58",
              "reason": "The lambda function has access to write logs",
            },
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
            {
              "id": "W92",
              "reason": "The lambda function only executes on stack creation and deletion and so does not need reserved concurrency.",
            },
            {
              "id": "W12",
              "reason": "Resource * is necessary for xray:PutTraceSegments and xray:PutTelemetryRecords.",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/uuidGenerator.zip",
        },
        "Description": "UUID Generator Lambda Function",
        "Environment": {
          "Variables": {
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
          },
        },
        "Handler": "index.handler",
        "ReservedConcurrentExecutions": 1,
        "Role": {
          "Fn::GetAtt": [
            "UUIDGeneratorRole",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 300,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "UUIDGeneratorPolicy": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The DescribeStacks,  PutTraceSegments, PutTelemetryRecords actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "UUIDGeneratorRole",
                  "Arn",
                ],
              },
            },
            {
              "Action": "cloudformation:DescribeStacks",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "UUIDGeneratorPolicy",
        "Roles": [
          {
            "Ref": "UUIDGeneratorRole",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "UUIDGeneratorRole": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "UUIDGeneratorSendAthenaMetricsLogGroup6B352C7B": {
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "UUIDGeneratorFunction",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "UpdatePermissionsForTablesEventsRule830DFE79": {
      "Properties": {
        "EventPattern": {
          "detail-type": [
            "Parameter Store Change",
          ],
          "resources": [
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition",
                  },
                  ":ssm:",
                  {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ":parameter",
                  {
                    "Ref": "ssmParameterForUpdatePermissionsBE1DF8D8",
                  },
                ],
              ],
            },
          ],
          "source": [
            "aws.ssm",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "CreateLakeFormationPermissionsB22A0089",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "UpdateSSMParameterPermissionsRoleB7EF2FE5": {
      "Condition": "CreateQuickSightQTopicsCondition",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "UpdateSSMParameterPermissionsRolePolicy0A6F6D36": {
      "Condition": "CreateQuickSightQTopicsCondition",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "All policies have been scoped to be as restrictive as possible. The create actions only support * as resource",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ssm:GetParameter",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametervpcFlowLogsBF597E17",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametercloudtrail552F6505",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametersecurityHub8017A884",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParameterappfabricA8D61F4D",
                      },
                    ],
                  ],
                },
              ],
              "Sid": "GetSSMParameter",
            },
            {
              "Action": "ssm:PutParameter",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametervpcFlowLogsBF597E17",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametercloudtrail552F6505",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParametersecurityHub8017A884",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:",
                      {
                        "Ref": "AWS::Region",
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId",
                      },
                      ":parameter",
                      {
                        "Ref": "SsmParameterappfabricA8D61F4D",
                      },
                    ],
                  ],
                },
              ],
              "Sid": "PutSSMParameter",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:/",
                    {
                      "Ref": "AWS::Partition",
                    },
                    "/lambda/*",
                  ],
                ],
              },
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "UpdateSSMParameterPermissionsRolePolicy0A6F6D36",
        "Roles": [
          {
            "Ref": "UpdateSSMParameterPermissionsRoleB7EF2FE5",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "UpdateSSMParametersCustomResource": {
      "Condition": "CreateQuickSightQTopicsCondition",
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CloudTrailTopic",
        "CreateLakeFormationPermissionsLogGroupB22E0017",
        "SecurityHubTopic",
        "UpdateSSMParameterPermissionsRolePolicy0A6F6D36",
        "UpdateSSMParametersLogGroup1EA4C599",
      ],
      "Properties": {
        "Region": {
          "Ref": "AWS::Region",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "UpdateSSMParametersFunction940B963D",
            "Arn",
          ],
        },
        "Version": {
          "Fn::FindInMap": [
            "Solution",
            "SolutionConfiguration",
            "Version",
          ],
        },
      },
      "Type": "Custom::UpdateSSMParameters",
      "UpdateReplacePolicy": "Delete",
    },
    "UpdateSSMParametersFunction940B963D": {
      "Condition": "CreateQuickSightQTopicsCondition",
      "DependsOn": [
        "UpdateSSMParameterPermissionsRoleB7EF2FE5",
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need access to resources in VPC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "",
              [
                "solutions-",
                {
                  "Ref": "AWS::Region",
                },
              ],
            ],
          },
          "S3Key": "security-insights-on-aws/v2.0.2/updateSsmParameters.zip",
        },
        "Description": "Lambda function to update SSM Parameters",
        "Environment": {
          "Variables": {
            "APP_FABRIC_SSM_PARAMETER_NAME": {
              "Fn::Join": [
                "",
                [
                  "/solutions/securityInsights/",
                  {
                    "Ref": "AWS::Region",
                  },
                  "/appfabric",
                ],
              ],
            },
            "CLOUDTRAIL_SSM_PARAMETER_NAME": {
              "Fn::Join": [
                "",
                [
                  "/solutions/securityInsights/",
                  {
                    "Ref": "AWS::Region",
                  },
                  "/cloudtrail",
                ],
              ],
            },
            "DELAY_IN_SECONDS_FOR_RATE_LIMITING": "1",
            "LOG_LEVEL": {
              "Fn::FindInMap": [
                "Solution",
                "InputConfiguration",
                {
                  "Ref": "LogLevel",
                },
              ],
            },
            "REGION": {
              "Ref": "AWS::Region",
            },
            "SECURITY_HUB_SSM_PARAMETER_NAME": {
              "Fn::Join": [
                "",
                [
                  "/solutions/securityInsights/",
                  {
                    "Ref": "AWS::Region",
                  },
                  "/securityHub",
                ],
              ],
            },
            "USER_AGENT_STRING": {
              "Fn::Sub": [
                "AWSSOLUTION/\${SolutionID}/\${Version}",
                {
                  "SolutionID": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "ID",
                    ],
                  },
                  "Version": {
                    "Fn::FindInMap": [
                      "Solution",
                      "SolutionConfiguration",
                      "Version",
                    ],
                  },
                },
              ],
            },
            "VPC_FLOW_LOGS_SSM_PARAMETER_NAME": {
              "Fn::Join": [
                "",
                [
                  "/solutions/securityInsights/",
                  {
                    "Ref": "AWS::Region",
                  },
                  "/vpcFlowLogs",
                ],
              ],
            },
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "ReservedConcurrentExecutions": 1,
        "Role": {
          "Fn::GetAtt": [
            "UpdateSSMParameterPermissionsRoleB7EF2FE5",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
        "Timeout": 300,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "UpdateSSMParametersLogGroup1EA4C599": {
      "Condition": "CreateQuickSightQTopicsCondition",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W84",
              "reason": "CloudWatch log group is always encrypted by default.",
            },
          ],
        },
      },
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "UpdateSSMParametersFunction940B963D",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "Tags": [
          {
            "Key": "awsApplication",
            "Value": {
              "Fn::GetAtt": [
                "AppRegistry",
                "ApplicationTagValue",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "convertAthenaThresholdValueToBytesCustomResource": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "ConvertAthenaThresholdValueToBytesLogGroup9C2F0C8C",
        "ConvertAthenaThresholdValueToBytesRolePolicy8B5CD36A",
      ],
      "Properties": {
        "AccountId": {
          "Ref": "AWS::AccountId",
        },
        "Region": {
          "Ref": "AWS::Region",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "ConvertAthenaThresholdValueToBytes123E1678",
            "Arn",
          ],
        },
        "ThresholdUnit": {
          "Ref": "ThresholdUnitForAthenaAlarm",
        },
        "ThresholdValue": {
          "Ref": "ThresholdValueForAthenaAlarm",
        },
      },
      "Type": "Custom::ConvertAthenaThresholdValueToBytes",
      "UpdateReplacePolicy": "Delete",
    },
    "createQuickSightDataSetRefreshSchedulesCustomResource": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CreateLakeFormationPermissionsCustomResource",
        "CreateQuickSightDataSetRefreshSchedulesLogGroupECB1BA2C",
        "CreateQuickSightDataSetRefreshSchedulesRolePolicyD365A7D5",
        "QuickSightDataSetCreator",
        "SecurityInsightsAnalysis",
      ],
      "Properties": {
        "AccountId": {
          "Ref": "AWS::AccountId",
        },
        "DayOfMonth": {
          "Ref": "MonthlyRefreshDay",
        },
        "DayOfWeek": {
          "Fn::FindInMap": [
            "Solution",
            "InputConfiguration",
            {
              "Ref": "WeeklyRefreshDay",
            },
          ],
        },
        "Interval": {
          "Ref": "Frequency",
        },
        "RefreshType": {
          "Fn::FindInMap": [
            "Solution",
            "QuickSightConfiguration",
            "RefreshType",
          ],
        },
        "Region": {
          "Ref": "AWS::Region",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "CreateQuickSightDataSetRefreshSchedules57C4A1CD",
            "Arn",
          ],
        },
        "Version": {
          "Fn::FindInMap": [
            "Solution",
            "SolutionConfiguration",
            "Version",
          ],
        },
      },
      "Type": "Custom::CreateQuickSightDataSetRefreshSchedules",
      "UpdateReplacePolicy": "Delete",
    },
    "glueResourceLinkDatabaseGlueDB3E8E6ADB": {
      "Properties": {
        "CatalogId": {
          "Ref": "AWS::AccountId",
        },
        "DatabaseInput": {
          "Name": {
            "Fn::FindInMap": [
              "Solution",
              "SecurityLakeConfiguration",
              "ResourceLinkDatabase",
            ],
          },
        },
      },
      "Type": "AWS::Glue::Database",
    },
    "ssmParameterForUpdatePermissionsBE1DF8D8": {
      "Properties": {
        "Description": "SSM parameter to update security lake permissions in the Security Lake",
        "Name": {
          "Fn::Join": [
            "",
            [
              "/solutions/securityInsights/",
              {
                "Ref": "AWS::Region",
              },
              "/updatePermissions",
            ],
          ],
        },
        "Tags": {
          "awsApplication": {
            "Fn::GetAtt": [
              "AppRegistry",
              "ApplicationTagValue",
            ],
          },
        },
        "Type": "String",
        "Value": "Version 1",
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
}
`;
